# ğŸ¤– å¿ƒè¯­Agentæ ¸å¿ƒæ¨¡å—

> å°†å¿ƒè¯­æœºå™¨äººä»"è¢«åŠ¨å“åº”"å‡çº§åˆ°"ä¸»åŠ¨æœåŠ¡"

## âœ¨ å¿«é€Ÿå¼€å§‹

### 1. æŸ¥çœ‹æ¼”ç¤º

```bash
cd /home/workSpace/emotional_chat
python demo_agent.py
```

### 2. å¯åŠ¨æœåŠ¡

```bash
python run_backend.py
```

### 3. æµ‹è¯•API

```bash
curl -X POST http://localhost:8000/agent/chat \
  -H "Content-Type: application/json" \
  -d '{"user_id": "user_123", "message": "æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œæ€ä¹ˆåŠï¼Ÿ"}'
```

## ğŸ“Š æ¶æ„æ€»è§ˆ

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ç”¨æˆ·äº¤äº’å±‚        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚          Agent Core æ™ºèƒ½æ ¸å¿ƒ             â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
          â”‚  â”‚ Planner  â”‚ â”‚Tool Callerâ”‚ â”‚Reflectorâ”‚ â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
        â”‚ Memory Hub â”‚                  â”‚External Toolsâ”‚
        â”‚  è®°å¿†ä¸­æ¢   â”‚                  â”‚  å¤–éƒ¨å·¥å…·    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½è§„åˆ’ (Planner)

è‡ªåŠ¨åˆ†è§£ç›®æ ‡ï¼Œé€‰æ‹©æœ€ä¼˜ç­–ç•¥

```python
ç”¨æˆ·: "æˆ‘æ€ä¹ˆèƒ½ç¡å¾—æ›´å¥½ï¼Ÿ"
Agent: 
  â†’ è¯†åˆ«ç›®æ ‡: é—®é¢˜è§£å†³
  â†’ åˆ†è§£ä»»åŠ¡: ç†è§£é—®é¢˜ â†’ æœç´¢æ–¹æ¡ˆ â†’ æ¨èèµ„æº â†’ å®‰æ’å›è®¿
  â†’ é€‰æ‹©ç­–ç•¥: Tool-Useç­–ç•¥
```

### 2. å·¥å…·è°ƒç”¨ (Tool Caller)

10+å†…ç½®å·¥å…·ï¼Œè‡ªåŠ¨è°ƒç”¨

- ğŸ” è®°å¿†å·¥å…·: `search_memory`, `get_emotion_log`
- â° å®šæ—¶å·¥å…·: `set_reminder`, `check_calendar`
- ğŸµ èµ„æºå·¥å…·: `recommend_meditation`, `recommend_resource`
- ğŸ“‹ è¯„ä¼°å·¥å…·: `psychological_assessment`

### 3. è®°å¿†ç®¡ç† (Memory Hub)

é•¿çŸ­æœŸè®°å¿†ï¼Œä¸ªæ€§åŒ–æœåŠ¡

- çŸ­æœŸè®°å¿†: å½“å‰å¯¹è¯ä¸Šä¸‹æ–‡
- é•¿æœŸè®°å¿†: å†å²äº‹ä»¶ã€æƒ…ç»ªã€åå¥½
- ç”¨æˆ·ç”»åƒ: æ€§æ ¼ç‰¹å¾ã€å…´è¶£çˆ±å¥½ã€æƒ…ç»ªåŸºçº¿

### 4. ä¸»åŠ¨å›è®¿ (Reflector)

å®šæ—¶å…³æ€€ï¼ŒæŒç»­æ”¯æŒ

```python
ä»Šå¤©: ç”¨æˆ·æåˆ°ç¡çœ é—®é¢˜
7å¤©å: Agentä¸»åŠ¨è¯¢é—® "ä½ æœ€è¿‘ç¡çœ æœ‰æ”¹å–„å—ï¼Ÿ"
```

### 5. åæ€ä¼˜åŒ–

æŒç»­å­¦ä¹ ï¼Œä¸æ–­è¿›åŒ–

- è¯„ä¼°æ¯æ¬¡äº¤äº’æ•ˆæœ
- åˆ†ææˆåŠŸ/å¤±è´¥æ¨¡å¼
- ä¼˜åŒ–è§„åˆ’ç­–ç•¥

## ğŸ“ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ agent/                      # Agentæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ agent_core.py           # æ€»æ§åˆ¶å™¨ (650è¡Œ)
â”‚   â”œâ”€â”€ memory_hub.py           # è®°å¿†ä¸­æ¢ (520è¡Œ)
â”‚   â”œâ”€â”€ planner.py              # è§„åˆ’å™¨ (450è¡Œ)
â”‚   â”œâ”€â”€ tool_caller.py          # å·¥å…·è°ƒç”¨å™¨ (680è¡Œ)
â”‚   â”œâ”€â”€ reflector.py            # åæ€å™¨ (580è¡Œ)
â”‚   â”œâ”€â”€ README.md               # è¯¦ç»†ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ tools/                  # å¤–éƒ¨å·¥å…·
â”‚       â”œâ”€â”€ calendar_api.py     # æ—¥å†æœåŠ¡
â”‚       â”œâ”€â”€ audio_player.py     # éŸ³é¢‘æ’­æ”¾
â”‚       â”œâ”€â”€ psychology_db.py    # å¿ƒç†èµ„æºåº“
â”‚       â””â”€â”€ scheduler_service.py # å®šæ—¶æé†’
â”‚
â”œâ”€â”€ routers/
â”‚   â””â”€â”€ agent.py                # Agentè·¯ç”±
â”‚
â”œâ”€â”€ services/
â”‚   â””â”€â”€ agent_service.py        # AgentæœåŠ¡å±‚
â”‚
â””â”€â”€ app.py                      # ä¸»åº”ç”¨ï¼ˆå·²é›†æˆï¼‰
```

## ğŸŒ APIæ¥å£

### AgentèŠå¤©

```http
POST /agent/chat
Content-Type: application/json

{
  "user_id": "user_123",
  "message": "æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œæ€ä¹ˆåŠï¼Ÿ"
}
```

**å“åº”**:
```json
{
  "code": 200,
  "data": {
    "success": true,
    "response": "æˆ‘ç†è§£ä½ çš„å›°æ‰°ã€‚ç¡çœ é—®é¢˜ç¡®å®å¾ˆå½±å“ç”Ÿæ´»è´¨é‡...",
    "emotion": "ç„¦è™‘",
    "emotion_intensity": 7.5,
    "actions": [
      {"type": "tool_call", "tool": "recommend_meditation", "success": true}
    ],
    "followup_scheduled": true,
    "response_time": 1.2
  }
}
```

### å…¶ä»–æ¥å£

- `GET /agent/status` - è·å–AgentçŠ¶æ€
- `GET /agent/history/{user_id}` - æŸ¥çœ‹æ‰§è¡Œå†å²
- `GET /agent/memory/{user_id}` - è·å–è®°å¿†æ‘˜è¦
- `GET /agent/tools` - æŸ¥çœ‹å¯ç”¨å·¥å…·
- `POST /agent/followup` - è§„åˆ’å›è®¿ä»»åŠ¡

## ğŸ”¥ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯1: é—®é¢˜è§£å†³

```python
from backend.agent import AgentCore

agent = AgentCore()

result = await agent.process(
    user_input="æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œæ€ä¹ˆåŠï¼Ÿ",
    user_id="user_123"
)

print(result["response"])
# è¾“å‡º: æˆ‘ç†è§£ä½ çš„å›°æ‰°ã€‚ç¡çœ é—®é¢˜ç¡®å®å¾ˆå½±å“ç”Ÿæ´»è´¨é‡...
#      æˆ‘ä¸ºä½ æ¨èäº†å‡ ä¸ªåŠ©çœ å†¥æƒ³ç»ƒä¹ ï¼š
#      1. æ·±åº¦ç¡çœ å¼•å¯¼å†¥æƒ³ï¼ˆ15åˆ†é’Ÿï¼‰
#      2. åŠ©çœ ç™½å™ªéŸ³ï¼ˆ30åˆ†é’Ÿï¼‰
#      ...
```

### åœºæ™¯2: å·¥å…·è°ƒç”¨

```python
from backend.agent import ToolCaller

tool_caller = ToolCaller()

# æ¨èå†¥æƒ³éŸ³é¢‘
result = await tool_caller.call(
    "recommend_meditation",
    {"theme": "sleep", "duration": 15}
)

for audio in result["result"]["recommendations"]:
    print(f"- {audio['title']} ({audio['duration']}åˆ†é’Ÿ)")
```

### åœºæ™¯3: è®°å¿†ç®¡ç†

```python
from backend.agent import MemoryHub

memory_hub = MemoryHub()

# æ£€ç´¢ç›¸å…³è®°å¿†
memories = memory_hub.retrieve(
    query="ç¡çœ é—®é¢˜",
    user_id="user_123",
    context={"emotion": "ç„¦è™‘"}
)

# è·å–ç”¨æˆ·ç”»åƒ
profile = memory_hub.get_user_profile("user_123")
print(f"ä¸»å¯¼æƒ…ç»ª: {profile['emotion_baseline']['dominant_emotion']}")
```

## ğŸ“ˆ å¯¹æ¯”ä¼˜åŠ¿

### ä¼ ç»Ÿæ¨¡å¼ vs Agentæ¨¡å¼

| ç‰¹æ€§ | ä¼ ç»Ÿæ¨¡å¼ | Agentæ¨¡å¼ |
|------|---------|----------|
| å“åº”æ–¹å¼ | è¢«åŠ¨å›å¤ | ä¸»åŠ¨æœåŠ¡ |
| ä»»åŠ¡è§„åˆ’ | å•ä¸€å›å¤ | æ™ºèƒ½åˆ†è§£ |
| å·¥å…·ä½¿ç”¨ | æ‰‹åŠ¨è°ƒç”¨ | è‡ªåŠ¨è°ƒç”¨ |
| è®°å¿†ç®¡ç† | ç®€å•å­˜å‚¨ | æ™ºèƒ½æ£€ç´¢ |
| åç»­è·Ÿè¿› | âŒ æ—  | âœ… ä¸»åŠ¨å›è®¿ |
| æ•ˆæœè¯„ä¼° | âŒ æ—  | âœ… åæ€ä¼˜åŒ– |

### å®é™…æ•ˆæœå¯¹æ¯”

**ä¼ ç»Ÿæ¨¡å¼**:
```
ç”¨æˆ·: "æˆ‘æœ€è¿‘ç¡ä¸å¥½"
æœºå™¨äºº: "ä½ å¯ä»¥è¯•è¯•å†¥æƒ³ã€‚"
ï¼ˆå¯¹è¯ç»“æŸï¼‰
```

**Agentæ¨¡å¼**:
```
ç”¨æˆ·: "æˆ‘æœ€è¿‘ç¡ä¸å¥½"
Agent: 
  1. åˆ†ææƒ…å†µï¼ˆæ£€æµ‹åˆ°ç„¦è™‘æƒ…ç»ªï¼‰
  2. æ£€ç´¢è®°å¿†ï¼ˆå‘ç°è¿ç»­7å¤©ç¡çœ è´¨é‡å·®ï¼‰
  3. åˆ¶å®šæ–¹æ¡ˆï¼ˆæ¨èå†¥æƒ³ + è®¾ç½®æé†’ + å®‰æ’å›è®¿ï¼‰
  4. æ‰§è¡Œè¡ŒåŠ¨ï¼ˆæ¨è3ä¸ªéŸ³é¢‘ + 21:30æé†’ï¼‰
  5. ä¸»åŠ¨è·Ÿè¿›ï¼ˆ7å¤©åè¯¢é—®æ”¹å–„æƒ…å†µï¼‰
```

## ğŸ“Š å®ç°ç»Ÿè®¡

```
æ–°å¢æ–‡ä»¶:    20+ ä¸ª
æ–°å¢ä»£ç :    ~4,500 è¡Œ
æ ¸å¿ƒæ¨¡å—:    5 ä¸ª
å¤–éƒ¨å·¥å…·:    4 ä¸ª
å†…ç½®å·¥å…·:    10+ ä¸ª
APIæ¥å£:     7 ä¸ª
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æ¶æ„æ–‡æ¡£**: [docs/è®°å¿†ç³»ç»Ÿæ¶æ„.md](docs/è®°å¿†ç³»ç»Ÿæ¶æ„.md)
- **ä½¿ç”¨æŒ‡å—**: [backend/agent/README.md](backend/agent/README.md)
- **å®ç°æ€»ç»“**: [docs/Agentæ ¸å¿ƒæ¨¡å—å®ç°æ€»ç»“.md](docs/Agentæ ¸å¿ƒæ¨¡å—å®ç°æ€»ç»“.md)
- **APIæ–‡æ¡£**: http://localhost:8000/docs

## ğŸš€ éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ

```bash
# 1. å¯åŠ¨æœåŠ¡
python run_backend.py

# 2. éªŒè¯Agentæ¨¡å—
curl http://localhost:8000/
# çœ‹åˆ° "agent_enabled": true è¡¨ç¤ºæˆåŠŸ

# 3. æŸ¥çœ‹APIæ–‡æ¡£
open http://localhost:8000/docs
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
export ENABLE_AGENT=true
export AGENT_MODE=smart

# 3. å¯åŠ¨æœåŠ¡
gunicorn backend.app:app --workers 4 --bind 0.0.0.0:8000
```

## ğŸ”§ é…ç½®

### ç¯å¢ƒå˜é‡

```env
# config.env

# Agentæ¨¡å—é…ç½®
ENABLE_AGENT=true           # å¯ç”¨Agentæ¨¡å—
AGENT_MODE=smart            # smart/simple/hybrid

# å·¥å…·é…ç½®
ENABLE_TOOLS=true           # å¯ç”¨å·¥å…·è°ƒç”¨
TOOL_TIMEOUT=30             # å·¥å…·è°ƒç”¨è¶…æ—¶ï¼ˆç§’ï¼‰

# å›è®¿é…ç½®
ENABLE_FOLLOWUP=true        # å¯ç”¨ä¸»åŠ¨å›è®¿
FOLLOWUP_INTERVAL=7         # é»˜è®¤å›è®¿é—´éš”ï¼ˆå¤©ï¼‰
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæ¼”ç¤º

```bash
python demo_agent.py
```

### å•å…ƒæµ‹è¯•

```bash
pytest tests/test_agent.py -v
```

### APIæµ‹è¯•

```bash
# æµ‹è¯•èŠå¤©æ¥å£
curl -X POST http://localhost:8000/agent/chat \
  -H "Content-Type: application/json" \
  -d '{"user_id": "test_user", "message": "æµ‹è¯•æ¶ˆæ¯"}'

# æŸ¥çœ‹AgentçŠ¶æ€
curl http://localhost:8000/agent/status
```

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ¸è¿›å¼é‡‡ç”¨**: å…ˆåœ¨éƒ¨åˆ†åŠŸèƒ½ä¸­è¯•ç”¨Agentæ¨¡å¼
2. **é™çº§ç­–ç•¥**: å‡†å¤‡éAgentæ¨¡å¼çš„åå¤‡æ–¹æ¡ˆ
3. **ç›‘æ§æŒ‡æ ‡**: æŒç»­ç›‘æ§å“åº”æ—¶é—´å’ŒæˆåŠŸç‡
4. **ç”¨æˆ·åé¦ˆ**: æ”¶é›†ç”¨æˆ·å¯¹Agentäº¤äº’çš„åé¦ˆ
5. **å®šæœŸä¼˜åŒ–**: æ ¹æ®åæ€æ¨¡å—çš„åˆ†æç»“æœä¼˜åŒ–ç­–ç•¥

## ğŸ”® æœªæ¥è®¡åˆ’

### çŸ­æœŸï¼ˆ1ä¸ªæœˆï¼‰
- [ ] é›†æˆçœŸå®çš„LLMæœåŠ¡ï¼ˆGPT-4ç­‰ï¼‰
- [ ] å®Œå–„å·¥å…·è°ƒç”¨å‚æ•°ç”Ÿæˆ
- [ ] æ·»åŠ æ›´å¤šå¿ƒç†èµ„æº
- [ ] ä¼˜åŒ–å›è®¿æ—¶é—´ç®—æ³•

### ä¸­æœŸï¼ˆ3ä¸ªæœˆï¼‰
- [ ] å®ç°çœŸå®çš„å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼ˆAPSchedulerï¼‰
- [ ] å¯¹æ¥Google Calendarç­‰å¤–éƒ¨API
- [ ] æ·»åŠ è¯­éŸ³è½¬æ–‡å­—æ”¯æŒ
- [ ] å®ç°ç”¨æˆ·åå¥½å­¦ä¹ 

### é•¿æœŸï¼ˆ6ä¸ªæœˆ+ï¼‰
- [ ] å¤šæ¨¡æ€æ”¯æŒï¼ˆè¯­éŸ³ã€å›¾ç‰‡ï¼‰
- [ ] ç¾¤ç»„èŠå¤©æ”¯æŒ
- [ ] ä¸“ä¸šå’¨è¯¢å¸ˆå¯¹æ¥
- [ ] A/Bæµ‹è¯•æ¡†æ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

### æ·»åŠ æ–°å·¥å…·

```python
# 1. åœ¨ backend/agent/tools/ åˆ›å»ºæ–°å·¥å…·æ–‡ä»¶
# 2. å®ç°å·¥å…·ç±»
class MyNewTool:
    def execute(self, **params):
        # å·¥å…·é€»è¾‘
        pass

# 3. æ³¨å†Œå·¥å…·
tool_caller = get_tool_caller()
tool_caller.registry.register(
    name="my_new_tool",
    description="æ–°å·¥å…·æè¿°",
    function=my_tool_function,
    parameters={...},
    category="custom"
)
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-10-15)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®ç°å®Œæ•´çš„Agentæ¶æ„
- âœ… æä¾›5ä¸ªæ ¸å¿ƒæ¨¡å—
- âœ… å†…ç½®10+å·¥å…·
- âœ… æä¾›7ä¸ªAPIæ¥å£
- âœ… å®Œå–„çš„æ–‡æ¡£

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤Issueã€‚

---

**Made with â¤ï¸ by å¿ƒè¯­å›¢é˜Ÿ**

*ä»è¢«åŠ¨å“åº”åˆ°ä¸»åŠ¨æœåŠ¡ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è¿›åŒ–ã€‚*

