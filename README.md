# æƒ…æ„ŸèŠå¤©æœºå™¨äºº ğŸ¤–ğŸ’

ä¸€ä¸ªåŸºäº **é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)** + MySQL + å‘é‡æ•°æ®åº“çš„æ™ºèƒ½æƒ…æ„Ÿæ”¯æŒèŠå¤©æœºå™¨äººï¼Œå…·æœ‰æƒ…æ„Ÿè¯†åˆ«ã€å…±æƒ…å›åº”ã€é•¿æœŸè®°å¿†å’Œæ•°æ®åˆ†æèƒ½åŠ›ã€‚

> **å‚è€ƒé¡¹ç›®**: [emotional_chat](https://github.com/congde/emotional_chat.git)

> **ğŸ†• æ›´æ–°è¯´æ˜**: æœ¬é¡¹ç›®å·²ä» OpenAI GPT è¿ç§»è‡³é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)ï¼Œæä¾›æ›´å¥½çš„ä¸­æ–‡æ”¯æŒå’Œæ›´ç¨³å®šçš„æœåŠ¡ã€‚

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- ğŸ­ **æƒ…æ„Ÿè¯†åˆ«**: æ™ºèƒ½åˆ†æç”¨æˆ·æƒ…æ„ŸçŠ¶æ€ï¼ˆå¼€å¿ƒã€éš¾è¿‡ã€ç„¦è™‘ã€æ„¤æ€’ç­‰ï¼‰
- ğŸ’ **å…±æƒ…å›åº”**: æ ¹æ®æƒ…æ„ŸçŠ¶æ€ç”Ÿæˆæ¸©æš–ã€ç†è§£çš„å›åº”åŠ›
- ğŸ§  **é•¿æœŸè®°å¿†**: âœ… å·²é›†æˆ Chroma å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒè·¨ä¼šè¯è¯­ä¹‰æ£€ç´¢
- ğŸ—„ï¸ **æ•°æ®æŒä¹…åŒ–**: MySQLæ•°æ®åº“å­˜å‚¨æ‰€æœ‰èŠå¤©è®°å½•å’Œç”¨æˆ·æ•°æ®
- ğŸ“Š **æƒ…æ„Ÿè¶‹åŠ¿åˆ†æ**: åˆ†æç”¨æˆ·æƒ…æ„Ÿå˜åŒ–è¶‹åŠ¿å’Œæ¨¡å¼
- ğŸ”’ **å®‰å…¨è¿‡æ»¤**: è‡ªåŠ¨æ£€æµ‹é«˜é£é™©è¯æ±‡å¹¶æä¾›ä¸“ä¸šæ±‚åŠ©ä¿¡æ¯
- ğŸ”„ **ä¸Šä¸‹æ–‡ç†è§£**: åŸºäºå¯¹è¯å†å²æä¾›è¿è´¯çš„å›åº”
- ğŸ¨ **ç¾è§‚ç•Œé¢**: ç°ä»£åŒ–çš„Reactå‰ç«¯ç•Œé¢
- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºFastAPI + LangChainçš„é«˜æ€§èƒ½åç«¯æœåŠ¡
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ä¼˜åŒ–**: ä½¿ç”¨é€šä¹‰åƒé—®æ¨¡å‹ï¼Œå¯¹ä¸­æ–‡ç†è§£å’Œè¡¨è¾¾æ›´åŠ è‡ªç„¶

### ğŸŒŸ é€šä¹‰åƒé—®æ¨¡å‹ä¼˜åŠ¿

- **å“è¶Šçš„ä¸­æ–‡èƒ½åŠ›**: é’ˆå¯¹ä¸­æ–‡åœºæ™¯æ·±åº¦ä¼˜åŒ–ï¼Œç†è§£å’Œè¡¨è¾¾æ›´è‡ªç„¶
- **æƒ…æ„Ÿå…±æƒ…å‡ºè‰²**: åœ¨å¿ƒç†å¥åº·åœºæ™¯è¡¨ç°ä¼˜å¼‚ï¼Œå›å¤æ¸©æš–ç»†è…»
- **ç¨³å®šå¯é **: é˜¿é‡Œäº‘åŸºç¡€è®¾æ–½ä¿éšœï¼ŒæœåŠ¡ç¨³å®šæ€§é«˜
- **æˆæœ¬ä¼˜åŒ–**: ç›¸æ¯”å›½å¤–æ¨¡å‹ï¼Œæ€§ä»·æ¯”æ›´é«˜

### ğŸ§  å‘é‡æ•°æ®åº“é•¿æœŸè®°å¿†ï¼ˆæ–°åŠŸèƒ½ï¼‰

**çŠ¶æ€**: âœ… å·²å®Œæˆé›†æˆ

**ç‰¹æ€§**:
- ğŸ” **è¯­ä¹‰æ£€ç´¢**: åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢å†å²å¯¹è¯
- ğŸŒ **è·¨ä¼šè¯è®°å¿†**: ä¸é™äºå½“å‰ä¼šè¯ï¼Œå¯è®¿é—®æ‰€æœ‰å†å²å¯¹è¯
- ğŸ“š **çŸ¥è¯†åº“ç®¡ç†**: æ”¯æŒå­˜å‚¨å’Œæ£€ç´¢å¿ƒç†å¥åº·çŸ¥è¯†
- ğŸ˜Š **æƒ…æ„Ÿæ¨¡å¼å­¦ä¹ **: å­¦ä¹ ç”¨æˆ·çš„æƒ…æ„Ÿè¡¨è¾¾æ¨¡å¼

**å·¥ä½œåŸç†**:
```
çŸ­æœŸè®°å¿† (MySQL)    +    é•¿æœŸè®°å¿† (Chromaå‘é‡æ•°æ®åº“)
æœ€è¿‘5æ¡å¯¹è¯              è·¨ä¼šè¯è¯­ä¹‰ç›¸ä¼¼å¯¹è¯
      â†“                        â†“
            ä¸Šä¸‹æ–‡èåˆ
                 â†“
          æ™ºèƒ½å›å¤ç”Ÿæˆ
```

**å®‰è£…å‘é‡æ•°æ®åº“** (å¯é€‰ï¼Œä½†æ¨è):
```bash
# å®‰è£…ä¾èµ– (éœ€è¦ Python 3.8+)
pip3 install --user chromadb sentence-transformers

# æŸ¥çœ‹è¯¦ç»†æŒ‡å—
cat VECTOR_DB_GUIDE.md
```

**æ³¨æ„**: å‘é‡æ•°æ®åº“æ˜¯å¯é€‰åŠŸèƒ½ï¼Œä¸å®‰è£…ä¹Ÿä¸å½±å“åŸºæœ¬èŠå¤©åŠŸèƒ½ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä¸ºä»…ä½¿ç”¨ MySQL çŸ­æœŸè®°å¿†ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ€»ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reactå‰ç«¯     â”‚    â”‚   FastAPIåç«¯   â”‚    â”‚   MySQLæ•°æ®åº“   â”‚
â”‚   (ç«¯å£3000)    â”‚â—„â”€â”€â–ºâ”‚   (ç«¯å£8000)    â”‚â—„â”€â”€â–ºâ”‚   (ç«¯å£3306)    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ èŠå¤©ç•Œé¢      â”‚    â”‚ â€¢ æƒ…æ„Ÿåˆ†æ      â”‚    â”‚ â€¢ ç”¨æˆ·æ•°æ®      â”‚
â”‚ â€¢ å®æ—¶äº¤äº’      â”‚    â”‚ â€¢ é€šä¹‰åƒé—®API   â”‚    â”‚ â€¢ å¯¹è¯å†å²      â”‚
â”‚ â€¢ å“åº”å¼è®¾è®¡    â”‚    â”‚ â€¢ ä¼šè¯ç®¡ç†      â”‚    â”‚ â€¢ æƒ…æ„Ÿè®°å½•      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è®¿é—®å±‚ (Access Layer)        â”‚
â”‚        ç”¨æˆ·ç•Œé¢ (Web/App/å°ç¨‹åº)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å¯¹è¯ç®¡ç†å±‚                     â”‚
â”‚   ä¼šè¯çŠ¶æ€ç®¡ç†ã€ä¸Šä¸‹æ–‡ç»´æŠ¤                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ ¸å¿ƒå¼•æ“å±‚                     â”‚
â”‚   å¤§æ¨¡å‹API+æç¤ºå·¥ç¨‹+Agenté€»è¾‘            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        çŸ¥è¯†ä¸è®°å¿†å±‚                      â”‚
â”‚  å‘é‡æ•°æ®åº“(é•¿æœŸè®°å¿†)ã€è§„åˆ™åº“(å®‰å…¨è¿‡æ»¤)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ•°æ®ä¸æœåŠ¡å±‚                      â”‚
â”‚  ç”¨æˆ·æ•°æ®ã€æ—¥å¿—ã€ç¬¬ä¸‰æ–¹æœåŠ¡(TTS/è¯­éŸ³)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### MySQLæ•°æ®åº“è¡¨ç»“æ„

#### 1. users - ç”¨æˆ·è¡¨
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(100) UNIQUE NOT NULL,
    username VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 2. chat_sessions - ä¼šè¯è¡¨
```sql
CREATE TABLE chat_sessions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) UNIQUE NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 3. chat_messages - æ¶ˆæ¯è¡¨
```sql
CREATE TABLE chat_messages (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL,  -- user, assistant
    content TEXT NOT NULL,
    emotion VARCHAR(50),
    emotion_intensity FLOAT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 4. emotion_analysis - æƒ…æ„Ÿåˆ†æè¡¨
```sql
CREATE TABLE emotion_analysis (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    message_id INT NOT NULL,
    emotion VARCHAR(50) NOT NULL,
    intensity FLOAT NOT NULL,
    keywords TEXT,
    suggestions TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. knowledge - çŸ¥è¯†åº“è¡¨
```sql
CREATE TABLE knowledge (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    category VARCHAR(100),
    tags TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 6. system_logs - ç³»ç»Ÿæ—¥å¿—è¡¨
```sql
CREATE TABLE system_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    level VARCHAR(20) NOT NULL,
    message TEXT NOT NULL,
    session_id VARCHAR(100),
    user_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **Python 3.8+**
- **é˜¿é‡Œäº‘é€šä¹‰åƒé—® (Qwen)**: å¤§è¯­è¨€æ¨¡å‹ (qwen-plus)
- **LangChain**: å¯¹è¯æµç®¡ç†å’Œè®°å¿†ç®¡ç†  
- **MySQL**: å…³ç³»å‹æ•°æ®åº“å­˜å‚¨
- **Chroma**: å‘é‡æ•°æ®åº“ï¼ˆé•¿æœŸè®°å¿†ï¼‰
- **FastAPI**: Webæ¡†æ¶
- **SQLAlchemy**: ORMæ¡†æ¶
- **Sentence Transformers**: æ–‡æœ¬åµŒå…¥

### å‰ç«¯
- **React 18**
- **Styled Components**: CSS-in-JS
- **Framer Motion**: åŠ¨ç”»æ•ˆæœ
- **Axios**: HTTPå®¢æˆ·ç«¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### 1.1 å®‰è£…ä¾èµ–
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/emotional_chat

# å®‰è£…Pythonä¾èµ–
pip3 install --user -r requirements.txt

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install
cd ..
```

#### 1.2 é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env_example.txt .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

é…ç½®å†…å®¹ï¼š
```bash
# APIé…ç½® - ä½¿ç”¨é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)
DASHSCOPE_API_KEY=your_qwen_api_key_here
API_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# MySQLæ•°æ®åº“é…ç½®
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=emotional_chat

# æ¨¡å‹é…ç½® - ä½¿ç”¨é€šä¹‰åƒé—®
DEFAULT_MODEL=qwen-plus
TEMPERATURE=0.7
MAX_TOKENS=1000

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000
DEBUG=true
```

**è·å–é€šä¹‰åƒé—® API Key**ï¼š
1. è®¿é—®é˜¿é‡Œäº‘ DashScope å¹³å°ï¼šhttps://dashscope.console.aliyun.com/
2. ç™»å½•é˜¿é‡Œäº‘è´¦å·
3. åˆ›å»º API Key
4. å°† API Key å¡«å…¥ `config.env` æ–‡ä»¶

#### 1.3 å®‰è£…å’Œé…ç½®MySQL
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server mysql-client

# CentOS/RHEL
sudo yum install mysql-server mysql

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# é…ç½®MySQLï¼ˆå¯é€‰ï¼‰
sudo mysql_secure_installation
```

### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆå§‹åŒ–MySQLæ•°æ®åº“å’Œè¡¨ç»“æ„
python3 setup_database.py
```

### 3. å¯åŠ¨æœåŠ¡

#### 3.1 å¯åŠ¨åç«¯æœåŠ¡
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼Œé¿å…æ–‡ä»¶ç›‘è§†é™åˆ¶é—®é¢˜ï¼‰
python3 run_backend.py

# æ–¹æ³•2ï¼šç›´æ¥åœ¨backendç›®å½•å¯åŠ¨
cd backend
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

> **æ³¨æ„**ï¼šå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° backend ç›®å½•è¿è¡Œï¼Œé¿å… watchfiles æ‰«æ frontend/node_modules å¯¼è‡´çš„æ–‡ä»¶ç›‘è§†é™åˆ¶é—®é¢˜ã€‚

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ï¼ŒAPIæ–‡æ¡£å¯åœ¨ `http://localhost:8000/docs` æŸ¥çœ‹ã€‚

#### 3.2 å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£
cd /home/emotional_chat/frontend

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£3000ï¼‰
npm start
```

å‰ç«¯åº”ç”¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚


### 4. éªŒè¯æœåŠ¡

**æ£€æŸ¥åç«¯æœåŠ¡**
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# æµ‹è¯•èŠå¤©æ¥å£
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼", "user_id": "test_user"}'
```

**æ£€æŸ¥å‰ç«¯æœåŠ¡**
- æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
- åº”è¯¥èƒ½çœ‹åˆ°èŠå¤©ç•Œé¢

### 5. ä½¿ç”¨è¯´æ˜

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„æƒ³æ³•å’Œæ„Ÿå—
3. æœºå™¨äººä¼šåˆ†æä½ çš„æƒ…æ„Ÿå¹¶ç»™å‡ºå…±æƒ…å›åº”
4. æ”¯æŒå¤šè½®å¯¹è¯ï¼Œæœºå™¨äººä¼šè®°ä½å¯¹è¯å†å²
5. æŸ¥çœ‹APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs

### 6. æ•…éšœæ’é™¤

**åç«¯å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ä¾èµ–å®‰è£…
pip3 list | grep fastapi

# æ‰‹åŠ¨å®‰è£…ä¾èµ–
pip3 install --user -r requirements.txt

# æ£€æŸ¥MySQLè¿æ¥
python3 setup_database.py
```

**å‰ç«¯å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
npm --version

# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
cd frontend
rm -rf node_modules package-lock.json
npm install
```

**ç«¯å£å†²çª**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8000
netstat -tulpn | grep :3000

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

## ğŸ¯ å¿«é€Ÿå¯åŠ¨æ€»ç»“

å¦‚æœæ‚¨å·²ç»å®‰è£…äº†ä¾èµ–ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ï¼š

**ç»ˆç«¯1 - å¯åŠ¨åç«¯ï¼š**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆæ¨èï¼‰
python3 run_backend.py

# æˆ–è€…è¿›å…¥backendç›®å½•è¿è¡Œ
cd backend
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

**ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯ï¼š**
```bash
cd /home/emotional_chat/frontend
npm start
```

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ç•Œé¢ï¼šhttp://localhost:3000
- åç«¯APIï¼šhttp://localhost:8000

**æµ‹è¯•ç³»ç»Ÿï¼š**
```bash
# æµ‹è¯•åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æµ‹è¯•èŠå¤©åŠŸèƒ½
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½", "user_id": "test_user"}'
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
emotional_chat/
â”œâ”€â”€ backend/                          # åç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                  # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ main.py                      # FastAPIä¸»åº”ç”¨ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ database.py                  # æ•°æ®åº“æ¨¡å‹å’Œæ“ä½œï¼ˆSQLAlchemy + MySQLï¼‰
â”‚   â”œâ”€â”€ models.py                    # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ simple_langchain_engine.py   # âœ… ä¸»èŠå¤©å¼•æ“ï¼ˆQwen API + æƒ…æ„Ÿåˆ†æï¼‰
â”‚   â”œâ”€â”€ emotion_analyzer.py          # æƒ…æ„Ÿåˆ†æå™¨
â”‚   â””â”€â”€ vector_store.py              # å‘é‡æ•°æ®åº“æ“ä½œ
â”‚
â”œâ”€â”€ frontend/                         # å‰ç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ index.html               # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ src/                         # æºä»£ç 
â”‚   â”‚   â”œâ”€â”€ App.js                   # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.js                 # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.css                # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ services/                # æœåŠ¡å±‚
â”‚   â”‚       â””â”€â”€ ChatAPI.js           # APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ package.json                 # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”‚   â””â”€â”€ package-lock.json            # ä¾èµ–é”å®šæ–‡ä»¶
â”‚
â”œâ”€â”€ config.py                         # é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«ç«¯å£ç­‰é…ç½®ï¼‰
â”œâ”€â”€ config.env                        # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆQwen API Keyç­‰ï¼‰
â”œâ”€â”€ env_example.txt                   # ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå‚è€ƒï¼‰
â”œâ”€â”€ setup_database.py                 # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ run_backend.py                    # åç«¯å¯åŠ¨è„šæœ¬ï¼ˆä¸»å…¥å£ï¼‰
â”œâ”€â”€ start.sh                          # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt                  # Pythonä¾èµ–åˆ—è¡¨
â”œâ”€â”€ LICENSE                           # å¼€æºè®¸å¯è¯
â””â”€â”€ README.md                         # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### æ–‡ä»¶è¯´æ˜

#### ğŸ”¥ æ ¸å¿ƒæ–‡ä»¶ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `backend/main.py` | åç«¯ä¸»ç¨‹åº | FastAPIåº”ç”¨å…¥å£ |
| `backend/simple_langchain_engine.py` | èŠå¤©å¼•æ“ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| `backend/database.py` | æ•°æ®åº“å±‚ | MySQLæ“ä½œå°è£… |
| `frontend/src/App.js` | å‰ç«¯ä¸»ç»„ä»¶ | Reactåº”ç”¨å…¥å£ |
| `setup_database.py` | æ•°æ®åº“åˆå§‹åŒ– | åˆ›å»ºè¡¨ç»“æ„ |
| `run_backend.py` | å¯åŠ¨è„šæœ¬ | å¯åŠ¨åç«¯æœåŠ¡ |

#### ğŸ“š è¾…åŠ©æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `backend/emotion_analyzer.py` | ç‹¬ç«‹æƒ…æ„Ÿåˆ†ææ¨¡å— |
| `backend/vector_store.py` | å‘é‡æ•°æ®åº“æ“ä½œå°è£… |

#### âš™ï¸ é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `config.py` | Pythoné…ç½®ï¼ˆç«¯å£ã€ä¸»æœºç­‰ï¼‰ |
| `config.env` | ç¯å¢ƒå˜é‡ï¼ˆé€šä¹‰åƒé—®APIå¯†é’¥ã€MySQLé…ç½®ï¼‰ |
| `env_example.txt` | ç¯å¢ƒå˜é‡æ¨¡æ¿ |

## ğŸ“¡ APIæ¥å£æ–‡æ¡£

### 1. å¥åº·æ£€æŸ¥
```bash
GET /health
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "timestamp": "2025-10-10T16:56:41.721768",
  "version": "2.0.0",
  "database": "connected",
  "vector_db": "ready"
}
```

### 2. èŠå¤©æ¥å£
```bash
POST /chat
Content-Type: application/json

{
  "message": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼",
  "user_id": "test_user",
  "session_id": "optional-session-id"
}
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "response": "ä½ å¥½ï¼Œå¬åˆ°ä½ ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼ğŸ˜Š",
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "emotion": "happy",
  "suggestions": [
    "å¾ˆé«˜å…´çœ‹åˆ°ä½ è¿™ä¹ˆå¼€å¿ƒï¼",
    "æœ‰ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…æƒ³è¦åˆ†äº«å—ï¼Ÿ"
  ],
  "timestamp": "2025-10-10T16:57:50.584646"
}
```

### 3. è·å–ä¼šè¯å†å²
```bash
GET /sessions/{session_id}/history?limit=20
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "messages": [
    {
      "role": "user",
      "content": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼",
      "emotion": "happy",
      "emotion_intensity": 8,
      "timestamp": "2025-10-10T16:57:50.000000"
    },
    {
      "role": "assistant",
      "content": "ä½ å¥½ï¼Œå¬åˆ°ä½ ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼ğŸ˜Š",
      "emotion": "empathetic",
      "timestamp": "2025-10-10T16:57:52.000000"
    }
  ]
}
```

### 4. è·å–ä¼šè¯æ‘˜è¦
```bash
GET /sessions/{session_id}/summary
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "message_count": 10,
  "emotion_distribution": {
    "happy": 5,
    "neutral": 3,
    "anxious": 2
  },
  "created_at": "2025-10-10T16:57:50.000000",
  "updated_at": "2025-10-10T17:05:20.000000"
}
```

### 5. è·å–ç”¨æˆ·æƒ…æ„Ÿè¶‹åŠ¿
```bash
GET /users/{user_id}/emotion-trends
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "user_id": "test_user",
  "total_records": 50,
  "recent_emotions": ["happy", "neutral", "anxious"],
  "average_intensity": 6.5,
  "emotion_counts": {
    "happy": 20,
    "neutral": 15,
    "anxious": 10,
    "sad": 5
  }
}
```

### å®Œæ•´APIæ–‡æ¡£
è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´çš„äº¤äº’å¼APIæ–‡æ¡£ï¼ˆSwagger UIï¼‰

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### æƒ…æ„Ÿåˆ†æ
- ä½¿ç”¨é€šä¹‰åƒé—® API è¿›è¡Œæ™ºèƒ½å¯¹è¯ç”Ÿæˆ
- æ”¯æŒå¤šç§æƒ…æ„Ÿç±»å‹ï¼šå¼€å¿ƒã€éš¾è¿‡ã€ç„¦è™‘ã€æ„¤æ€’ç­‰
- æä¾›æƒ…æ„Ÿå¼ºåº¦è¯„ä¼°ï¼ˆ0-10åˆ†ï¼‰

### å…±æƒ…å›åº”ç”Ÿæˆ
- åŸºäºæƒ…æ„ŸçŠ¶æ€ç”Ÿæˆä¸ªæ€§åŒ–å›åº”
- ç»“åˆå¯¹è¯å†å²å’ŒçŸ¥è¯†åº“æä¾›ä¸Šä¸‹æ–‡ç›¸å…³å›å¤
- æ”¯æŒæƒ…æ„Ÿæ ‡ç­¾å’Œå»ºè®®ç”Ÿæˆ

### å‘é‡æ•°æ®åº“é›†æˆ
- ä½¿ç”¨Chromaå­˜å‚¨å¯¹è¯å†å²
- æ”¯æŒç›¸ä¼¼å¯¹è¯æ£€ç´¢
- çŸ¥è¯†åº“ç®¡ç†å’Œæ£€ç´¢
- æƒ…æ„Ÿæ¨¡å¼å­¦ä¹ 

## ğŸ”§ APIæ¥å£

### èŠå¤©æ¥å£
```http
POST http://localhost:8000/chat
Content-Type: application/json

{
  "message": "ç”¨æˆ·æ¶ˆæ¯",
  "session_id": "ä¼šè¯IDï¼ˆå¯é€‰ï¼‰",
  "user_id": "ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰"
}
```

### ä¼šè¯å†å²
```http
GET http://localhost:8000/sessions/{session_id}/history?limit=20
```

### ä¼šè¯æ‘˜è¦
```http
GET http://localhost:8000/sessions/{session_id}/summary
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

- ç°ä»£åŒ–çš„èŠå¤©ç•Œé¢è®¾è®¡
- æƒ…æ„Ÿæ ‡ç­¾å¯è§†åŒ–
- å»ºè®®æŒ‰é’®å¿«é€Ÿå›å¤
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

## ğŸ”® æœªæ¥è§„åˆ’

- [ ] é›†æˆLlamaIndexè¿›è¡ŒçŸ¥è¯†å¢å¼º
- [ ] æ·»åŠ è¯­éŸ³äº¤äº’åŠŸèƒ½
- [ ] æ”¯æŒå¤šè¯­è¨€
- [ ] æƒ…æ„Ÿè¶‹åŠ¿åˆ†æ
- [ ] ä¸ªæ€§åŒ–æ¨èç³»ç»Ÿ
- [ ] ç§»åŠ¨ç«¯Appå¼€å‘

## ğŸš€ ç”Ÿäº§éƒ¨ç½²

### éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒçš„`.env`æ–‡ä»¶
- [ ] æ›´æ–°CORSå…è®¸çš„åŸŸåï¼ˆä¸è¦ä½¿ç”¨`*`ï¼‰
- [ ] é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
- [ ] å¯ç”¨HTTPS/SSLè¯ä¹¦
- [ ] é…ç½®æ•°æ®åº“å¤‡ä»½ç­–ç•¥
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®ç›‘æ§å’Œå‘Šè­¦

### Nginxé…ç½®ç¤ºä¾‹

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p emotional_chat > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u root -p emotional_chat < backup_20251010.sql

# è®¾ç½®è‡ªåŠ¨å¤‡ä»½ï¼ˆcrontabï¼‰
0 2 * * * mysqldump -u root -p[password] emotional_chat > /backup/emotional_chat_$(date +\%Y\%m\%d).sql
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿç›‘æ§

```bash
# æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æŸ¥çœ‹MySQLè¿æ¥æ•°
mysql -u root -p -e "SHOW STATUS LIKE 'Threads_connected';"

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
mysql -u root -p -e "SELECT table_schema AS 'Database', ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)' FROM information_schema.tables WHERE table_schema = 'emotional_chat' GROUP BY table_schema;"
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰
mysql -u root -p -e "SELECT * FROM emotional_chat.system_logs ORDER BY created_at DESC LIMIT 20;"

# æŸ¥çœ‹ç”¨æˆ·æ´»è·ƒåº¦
mysql -u root -p -e "SELECT DATE(created_at) as date, COUNT(DISTINCT user_id) as active_users FROM emotional_chat.chat_messages GROUP BY DATE(created_at) ORDER BY date DESC LIMIT 7;"

# æŸ¥çœ‹æƒ…æ„Ÿåˆ†å¸ƒç»Ÿè®¡
mysql -u root -p -e "SELECT emotion, COUNT(*) as count FROM emotional_chat.chat_messages WHERE emotion IS NOT NULL GROUP BY emotion ORDER BY count DESC;"
```

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

---

ğŸ’ **è®©AIæ›´æœ‰æ¸©åº¦ï¼Œè®©é™ªä¼´æ›´æ‡‚ä½ ** ğŸ’
