# å¿ƒè¯­æƒ…æ„Ÿé™ªä¼´æœºå™¨äºº ğŸ¤–ğŸ’

ä¸€ä¸ªåŸºäº **é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)** + **Agentæ¶æ„** + **RAGçŸ¥è¯†åº“** + **å‘é‡æ•°æ®åº“** çš„æ™ºèƒ½æƒ…æ„Ÿæ”¯æŒèŠå¤©æœºå™¨äººï¼Œå…·æœ‰æƒ…æ„Ÿè¯†åˆ«ã€å…±æƒ…å›åº”ã€ä¸»åŠ¨æœåŠ¡ã€é•¿æœŸè®°å¿†å’Œæ•°æ®åˆ†æèƒ½åŠ›ã€‚

> **å‚è€ƒé¡¹ç›®**: [emotional_chat](https://github.com/congde/emotional_chat.git)

> **ğŸ†• æ›´æ–°è¯´æ˜ v3.0.0**: 
> - âœ… ä» OpenAI GPT è¿ç§»è‡³é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)
> - âœ… é›†æˆ Agent æ™ºèƒ½æ ¸å¿ƒï¼ˆä»è¢«åŠ¨å“åº”å‡çº§åˆ°ä¸»åŠ¨æœåŠ¡ï¼‰
> - âœ… é›†æˆ RAG çŸ¥è¯†åº“ç³»ç»Ÿï¼ˆä¸“ä¸šå¿ƒç†å¥åº·çŸ¥è¯†å¢å¼ºï¼‰
> - âœ… åˆ†å±‚æœåŠ¡æ¶æ„é‡æ„ï¼ˆæ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼‰
> - âœ… Docker å®¹å™¨åŒ–æ”¯æŒï¼ˆä¸€é”®éƒ¨ç½²ï¼‰

## ğŸ“‘ ç›®å½•

- [åŠŸèƒ½ç‰¹ç‚¹](#-åŠŸèƒ½ç‰¹ç‚¹)
- [ç³»ç»Ÿæ¶æ„](#ï¸-ç³»ç»Ÿæ¶æ„)
- [æ•°æ®åº“è®¾è®¡](#ï¸-æ•°æ®åº“è®¾è®¡)
- [æŠ€æœ¯æ ˆ](#ï¸-æŠ€æœ¯æ ˆ)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [APIæ¥å£æ–‡æ¡£](#-apiæ¥å£æ–‡æ¡£)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#-æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [æœªæ¥è§„åˆ’](#-æœªæ¥è§„åˆ’)
- [ç‰ˆæœ¬å†å²](#-ç‰ˆæœ¬å†å²)
- [ç”Ÿäº§éƒ¨ç½²](#-ç”Ÿäº§éƒ¨ç½²)
- [Makefileå‘½ä»¤](#ï¸-makefile-å‘½ä»¤é€ŸæŸ¥)
- [ç›¸å…³æ–‡æ¡£](#-ç›¸å…³æ–‡æ¡£)
- [è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ­ **æƒ…æ„Ÿè¯†åˆ«**: æ™ºèƒ½åˆ†æç”¨æˆ·æƒ…æ„ŸçŠ¶æ€ï¼ˆå¼€å¿ƒã€éš¾è¿‡ã€ç„¦è™‘ã€æ„¤æ€’ç­‰ï¼‰
- ğŸ’ **å…±æƒ…å›åº”**: æ ¹æ®æƒ…æ„ŸçŠ¶æ€ç”Ÿæˆæ¸©æš–ã€ç†è§£çš„å›åº”
- ğŸ§  **é•¿æœŸè®°å¿†**: âœ… Chroma å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒè·¨ä¼šè¯è¯­ä¹‰æ£€ç´¢
- ğŸ“š **RAGçŸ¥è¯†åº“**: âœ… é›†æˆä¸“ä¸šå¿ƒç†å¥åº·çŸ¥è¯†åº“ï¼Œæä¾›ç§‘å­¦ä¾æ®çš„å»ºè®®
- ğŸ¤– **Agentæ™ºèƒ½æ ¸å¿ƒ**: âœ… ä»è¢«åŠ¨å“åº”å‡çº§åˆ°ä¸»åŠ¨æœåŠ¡ï¼Œæ™ºèƒ½ä»»åŠ¡è§„åˆ’å’Œå·¥å…·è°ƒç”¨
- ğŸ—„ï¸ **æ•°æ®æŒä¹…åŒ–**: MySQL + Redis å¤šå±‚å­˜å‚¨æ¶æ„
- ğŸ“Š **æƒ…æ„Ÿè¶‹åŠ¿åˆ†æ**: åˆ†æç”¨æˆ·æƒ…æ„Ÿå˜åŒ–è¶‹åŠ¿å’Œæ¨¡å¼
- ğŸ”„ **ä¸Šä¸‹æ–‡ç†è§£**: åŸºäºå¯¹è¯å†å²å’Œç”¨æˆ·ç”»åƒæä¾›è¿è´¯çš„å›åº”

### æŠ€æœ¯ç‰¹æ€§
- ğŸš€ **é«˜æ€§èƒ½æ¶æ„**: FastAPI + LangChain + åˆ†å±‚æœåŠ¡æ¶æ„
- ğŸ¨ **ç°ä»£åŒ–ç•Œé¢**: React 18 + Styled Components
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**: Docker Compose ä¸€é”®éƒ¨ç½²
- ğŸ“ˆ **ç›‘æ§ä½“ç³»**: Prometheus + Grafana å®Œæ•´ç›‘æ§
- ğŸ”’ **å®‰å…¨è¿‡æ»¤**: è‡ªåŠ¨æ£€æµ‹é«˜é£é™©è¯æ±‡å¹¶æä¾›ä¸“ä¸šæ±‚åŠ©ä¿¡æ¯
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡ä¼˜åŒ–**: ä½¿ç”¨é€šä¹‰åƒé—®æ¨¡å‹ï¼Œå¯¹ä¸­æ–‡ç†è§£å’Œè¡¨è¾¾æ›´åŠ è‡ªç„¶
- ğŸ”„ **æ•°æ®åº“è¿ç§»**: Alembic ç®¡ç†æ•°æ®åº“ç‰ˆæœ¬

### ğŸŒŸ é€šä¹‰åƒé—®æ¨¡å‹ä¼˜åŠ¿

- **å“è¶Šçš„ä¸­æ–‡èƒ½åŠ›**: é’ˆå¯¹ä¸­æ–‡åœºæ™¯æ·±åº¦ä¼˜åŒ–ï¼Œç†è§£å’Œè¡¨è¾¾æ›´è‡ªç„¶
- **æƒ…æ„Ÿå…±æƒ…å‡ºè‰²**: åœ¨å¿ƒç†å¥åº·åœºæ™¯è¡¨ç°ä¼˜å¼‚ï¼Œå›å¤æ¸©æš–ç»†è…»
- **ç¨³å®šå¯é **: é˜¿é‡Œäº‘åŸºç¡€è®¾æ–½ä¿éšœï¼ŒæœåŠ¡ç¨³å®šæ€§é«˜
- **æˆæœ¬ä¼˜åŒ–**: ç›¸æ¯”å›½å¤–æ¨¡å‹ï¼Œæ€§ä»·æ¯”æ›´é«˜

### ğŸ¤– Agentæ™ºèƒ½æ ¸å¿ƒï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

**çŠ¶æ€**: âœ… å·²å®Œæˆé›†æˆ

ä»"è¢«åŠ¨å“åº”"å‡çº§åˆ°"ä¸»åŠ¨æœåŠ¡"çš„æ™ºèƒ½å¯¹è¯ç³»ç»Ÿã€‚

**æ ¸å¿ƒç»„ä»¶**:
- ğŸ§  **Planner (è§„åˆ’å™¨)**: æ™ºèƒ½ä»»åŠ¡åˆ†è§£å’Œç­–ç•¥é€‰æ‹©
- ğŸ› ï¸ **Tool Caller (å·¥å…·è°ƒç”¨å™¨)**: 10+ å†…ç½®å·¥å…·è‡ªåŠ¨è°ƒç”¨
- ğŸ’¾ **Memory Hub (è®°å¿†ä¸­æ¢)**: é•¿çŸ­æœŸè®°å¿†ç®¡ç†å’Œç”¨æˆ·ç”»åƒ
- ğŸ”„ **Reflector (åæ€å™¨)**: ä¸»åŠ¨å›è®¿å’Œç­–ç•¥ä¼˜åŒ–
- âš™ï¸ **Agent Core (æ ¸å¿ƒæ§åˆ¶å™¨)**: ç»Ÿç­¹åè°ƒæ‰€æœ‰ç»„ä»¶

**å·¥ä½œåŸç†**:
```
ç”¨æˆ·è¾“å…¥ â†’ Agent Core
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚   Planner   â”‚ åˆ†æç›®æ ‡ã€åˆ†è§£ä»»åŠ¡
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚  Memory Hub â”‚ æ£€ç´¢è®°å¿†ã€æ„å»ºç”»åƒ
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚ Tool Caller â”‚ è°ƒç”¨å·¥å…·ã€æ‰§è¡Œä»»åŠ¡
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚  Reflector  â”‚ è¯„ä¼°æ•ˆæœã€è§„åˆ’å›è®¿
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â†“
      æ™ºèƒ½å›å¤ç”Ÿæˆ
```

**è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ [AGENT_README.md](AGENT_README.md)

### ğŸ“š RAGçŸ¥è¯†åº“ç³»ç»Ÿ

**çŠ¶æ€**: âœ… å·²å®Œæˆé›†æˆ

é›†æˆä¸“ä¸šå¿ƒç†å¥åº·çŸ¥è¯†åº“ï¼Œæä¾›æœ‰ç§‘å­¦ä¾æ®çš„å»ºè®®ã€‚

**ç‰¹æ€§**:
- ğŸ“– **çŸ¥è¯†åŠ è½½**: æ”¯æŒ PDFã€æ–‡æœ¬ç­‰å¤šç§æ ¼å¼
- ğŸ” **è¯­ä¹‰æ£€ç´¢**: åŸºäºå‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ç›¸å…³çŸ¥è¯†
- ğŸ’¡ **æ™ºèƒ½å¢å¼º**: è‡ªåŠ¨åˆ¤æ–­ä½•æ—¶ä½¿ç”¨çŸ¥è¯†åº“
- ğŸ¯ **ç²¾å‡†åŒ¹é…**: 6å¤§ç±»å¿ƒç†å¥åº·çŸ¥è¯†åˆ†ç±»

**çŸ¥è¯†ç±»åˆ«**:
1. è®¤çŸ¥è¡Œä¸ºç–—æ³•ï¼ˆCBTï¼‰
2. æ­£å¿µå‡å‹æŠ€æœ¯ï¼ˆMBSRï¼‰
3. ç§¯æå¿ƒç†å­¦
4. ç„¦è™‘åº”å¯¹ç­–ç•¥
5. ç¡çœ æ”¹å–„æ–¹æ³•
6. æƒ…ç»ªè°ƒèŠ‚æŠ€å·§

**åˆå§‹åŒ–çŸ¥è¯†åº“**:
```bash
# åˆå§‹åŒ–å†…ç½®çŸ¥è¯†
make rag-init

# æˆ–ç›´æ¥è¿è¡Œ
python init_rag_knowledge.py
```

**è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ [docs/RAGå®æ–½æ­¥éª¤.md](docs/RAGå®æ–½æ­¥éª¤.md)

### ğŸ§  è®°å¿†ç³»ç»Ÿ

**å¤šå±‚è®°å¿†æ¶æ„**:
```
çŸ­æœŸè®°å¿† (MySQL)    +    é•¿æœŸè®°å¿† (Chromaå‘é‡æ•°æ®åº“)
å½“å‰ä¼šè¯å¯¹è¯              è·¨ä¼šè¯è¯­ä¹‰ç›¸ä¼¼å¯¹è¯
      â†“                        â†“
            ä¸Šä¸‹æ–‡èåˆ
                 â†“
            ç”¨æˆ·ç”»åƒ
                 â†“
          æ™ºèƒ½å›å¤ç”Ÿæˆ
```

**ç‰¹æ€§**:
- ğŸ” **è¯­ä¹‰æ£€ç´¢**: åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢å†å²å¯¹è¯
- ğŸŒ **è·¨ä¼šè¯è®°å¿†**: ä¸é™äºå½“å‰ä¼šè¯ï¼Œå¯è®¿é—®æ‰€æœ‰å†å²å¯¹è¯
- ğŸ‘¤ **ç”¨æˆ·ç”»åƒ**: è‡ªåŠ¨æ„å»ºç”¨æˆ·æ€§æ ¼ç‰¹å¾å’Œåå¥½
- ğŸ˜Š **æƒ…æ„Ÿæ¨¡å¼å­¦ä¹ **: å­¦ä¹ ç”¨æˆ·çš„æƒ…æ„Ÿè¡¨è¾¾æ¨¡å¼

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ€»ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯å±‚ (Frontend)                   â”‚
â”‚              React 18 + Styled Components            â”‚
â”‚                    ç«¯å£: 3000                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è·¯ç”±å±‚ (Router)                    â”‚
â”‚    Chat | Memory | Feedback | Evaluation | RAG       â”‚
â”‚                    Agent Router                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æœåŠ¡å±‚ (Service)                    â”‚
â”‚  ChatService | MemoryService | ContextService        â”‚
â”‚              AgentService (å¯é€‰)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ ¸å¿ƒå±‚ (Core/Module)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Agent Core   â”‚  â”‚  RAG Module  â”‚  â”‚ LLM Moduleâ”‚  â”‚
â”‚  â”‚ â€¢ Planner    â”‚  â”‚ â€¢ KB Manager â”‚  â”‚â€¢ Qwen API â”‚  â”‚
â”‚  â”‚ â€¢ Tool Callerâ”‚  â”‚ â€¢ Retriever  â”‚  â”‚â€¢ LangChainâ”‚  â”‚
â”‚  â”‚ â€¢ Memory Hub â”‚  â”‚ â€¢ Embedder   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ â€¢ Reflector  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚ (Data)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  MySQL   â”‚  â”‚ ChromaDB â”‚  â”‚  Redis   â”‚           â”‚
â”‚  â”‚å…³ç³»æ•°æ®åº“ â”‚  â”‚å‘é‡æ•°æ®åº“â”‚  â”‚  ç¼“å­˜    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æœåŠ¡æ¶æ„è¯¦è§£

#### 1. è·¯ç”±å±‚ (Router Layer)
è´Ÿè´£APIæ¥å£å®šä¹‰å’Œè¯·æ±‚åˆ†å‘

```
backend/routers/
â”œâ”€â”€ chat.py          - èŠå¤©æ¥å£
â”œâ”€â”€ memory.py        - è®°å¿†ç®¡ç†æ¥å£
â”œâ”€â”€ feedback.py      - ç”¨æˆ·åé¦ˆæ¥å£
â”œâ”€â”€ evaluation.py    - è¯„ä¼°ç³»ç»Ÿæ¥å£
â””â”€â”€ agent_router.py  - Agentæ™ºèƒ½æ¥å£
```

#### 2. æœåŠ¡å±‚ (Service Layer)
ä¸šåŠ¡é€»è¾‘å°è£…å’Œç¼–æ’

```
backend/services/
â”œâ”€â”€ chat_service.py      - èŠå¤©æœåŠ¡
â”œâ”€â”€ memory_service.py    - è®°å¿†æœåŠ¡
â”œâ”€â”€ context_service.py   - ä¸Šä¸‹æ–‡æœåŠ¡
â””â”€â”€ agent_service.py     - AgentæœåŠ¡ï¼ˆå¯é€‰ï¼‰
```

#### 3. æ ¸å¿ƒå±‚ (Core/Module Layer)
æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

```
backend/modules/
â”œâ”€â”€ agent/          - Agentæ™ºèƒ½æ ¸å¿ƒ
â”‚   â”œâ”€â”€ core/       - Agent Core, Planner, Tool Callerç­‰
â”‚   â”œâ”€â”€ services/   - AgentæœåŠ¡å®ç°
â”‚   â””â”€â”€ routers/    - Agentè·¯ç”±
â”œâ”€â”€ rag/            - RAGçŸ¥è¯†åº“ç³»ç»Ÿ
â”‚   â”œâ”€â”€ core/       - çŸ¥è¯†åº“ç®¡ç†ã€æ£€ç´¢
â”‚   â”œâ”€â”€ services/   - RAGæœåŠ¡
â”‚   â””â”€â”€ routers/    - RAGè·¯ç”±
â””â”€â”€ llm/            - LLMæ¨¡å‹å°è£…
    â””â”€â”€ qwen_client.py - é€šä¹‰åƒé—®å®¢æˆ·ç«¯
```

#### 4. æ•°æ®å±‚ (Data Layer)
æ•°æ®å­˜å‚¨å’Œç®¡ç†

- **MySQL**: ç”¨æˆ·æ•°æ®ã€å¯¹è¯å†å²ã€æƒ…æ„Ÿè®°å½•
- **ChromaDB**: å‘é‡å­˜å‚¨ã€è¯­ä¹‰æ£€ç´¢
- **Redis**: ç¼“å­˜ã€ä¼šè¯çŠ¶æ€ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### MySQLæ•°æ®åº“è¡¨ç»“æ„

#### 1. users - ç”¨æˆ·è¡¨
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id VARCHAR(100) UNIQUE NOT NULL,
    username VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 2. chat_sessions - ä¼šè¯è¡¨
```sql
CREATE TABLE chat_sessions (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) UNIQUE NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 3. chat_messages - æ¶ˆæ¯è¡¨
```sql
CREATE TABLE chat_messages (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    role VARCHAR(20) NOT NULL,  -- user, assistant
    content TEXT NOT NULL,
    emotion VARCHAR(50),
    emotion_intensity FLOAT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 4. emotion_analysis - æƒ…æ„Ÿåˆ†æè¡¨
```sql
CREATE TABLE emotion_analysis (
    id INT PRIMARY KEY AUTO_INCREMENT,
    session_id VARCHAR(100) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    message_id INT NOT NULL,
    emotion VARCHAR(50) NOT NULL,
    intensity FLOAT NOT NULL,
    keywords TEXT,
    suggestions TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 5. knowledge - çŸ¥è¯†åº“è¡¨
```sql
CREATE TABLE knowledge (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    category VARCHAR(100),
    tags TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### 6. system_logs - ç³»ç»Ÿæ—¥å¿—è¡¨
```sql
CREATE TABLE system_logs (
    id INT PRIMARY KEY AUTO_INCREMENT,
    level VARCHAR(20) NOT NULL,
    message TEXT NOT NULL,
    session_id VARCHAR(100),
    user_id VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯

#### æ ¸å¿ƒæ¡†æ¶
- **Python 3.8+**: ä¸»è¦å¼€å‘è¯­è¨€
- **FastAPI 0.83+**: ç°ä»£åŒ–çš„Webæ¡†æ¶
- **LangChain 0.1+**: å¯¹è¯æµç®¡ç†å’Œè®°å¿†ç®¡ç†
- **Pydantic**: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

#### AI & å¤§æ¨¡å‹
- **é˜¿é‡Œäº‘é€šä¹‰åƒé—® (Qwen Plus)**: å¤§è¯­è¨€æ¨¡å‹
- **LangChain-OpenAI**: LLMé›†æˆ
- **Sentence Transformers**: æ–‡æœ¬åµŒå…¥æ¨¡å‹

#### æ•°æ®å­˜å‚¨
- **MySQL 8.0**: å…³ç³»å‹æ•°æ®åº“ï¼ˆç”¨æˆ·æ•°æ®ã€å¯¹è¯å†å²ï¼‰
- **ChromaDB 0.4+**: å‘é‡æ•°æ®åº“ï¼ˆè¯­ä¹‰æ£€ç´¢ã€é•¿æœŸè®°å¿†ï¼‰
- **Redis 7**: ç¼“å­˜å’Œä¼šè¯ç®¡ç†ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **SQLAlchemy 1.4+**: ORMæ¡†æ¶
- **Alembic**: æ•°æ®åº“è¿ç§»å·¥å…·

#### æ–‡æ¡£å¤„ç†
- **PyPDF 3.17+**: PDFæ–‡æ¡£è§£æ
- **python-multipart**: æ–‡ä»¶ä¸Šä¼ æ”¯æŒ

#### è¿ç»´å·¥å…·
- **Docker & Docker Compose**: å®¹å™¨åŒ–éƒ¨ç½²
- **Prometheus**: æŒ‡æ ‡ç›‘æ§
- **Grafana**: æ•°æ®å¯è§†åŒ–
- **Elasticsearch & Kibana**: æ—¥å¿—èšåˆå’Œåˆ†æ
- **Nginx**: åå‘ä»£ç†

### å‰ç«¯æŠ€æœ¯
- **React 18**: UIæ¡†æ¶
- **Styled Components**: CSS-in-JSæ ·å¼æ–¹æ¡ˆ
- **Framer Motion**: åŠ¨ç”»æ•ˆæœåº“
- **Axios**: HTTPå®¢æˆ·ç«¯

### å¼€å‘å·¥å…·
- **Makefile**: å‘½ä»¤è¡Œå·¥å…·é›†æˆ
- **Python dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†
- **Logging**: ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### 1.1 å®‰è£…ä¾èµ–
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/emotional_chat

# å®‰è£…Pythonä¾èµ–
pip3 install --user -r requirements.txt

# å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install
cd ..
```

#### 1.2 é…ç½®ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env_example.txt .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

é…ç½®å†…å®¹ï¼š
```bash
# APIé…ç½® - ä½¿ç”¨é˜¿é‡Œäº‘é€šä¹‰åƒé—®(Qwen)
DASHSCOPE_API_KEY=your_qwen_api_key_here
API_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# MySQLæ•°æ®åº“é…ç½®
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=root
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=emotional_chat

# æ¨¡å‹é…ç½® - ä½¿ç”¨é€šä¹‰åƒé—®
DEFAULT_MODEL=qwen-plus
TEMPERATURE=0.7
MAX_TOKENS=1000

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000
DEBUG=true
```

**è·å–é€šä¹‰åƒé—® API Key**ï¼š
1. è®¿é—®é˜¿é‡Œäº‘ DashScope å¹³å°ï¼šhttps://dashscope.console.aliyun.com/
2. ç™»å½•é˜¿é‡Œäº‘è´¦å·
3. åˆ›å»º API Key
4. å°† API Key å¡«å…¥ `config.env` æ–‡ä»¶

#### 1.3 å®‰è£…å’Œé…ç½®MySQL
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server mysql-client

# CentOS/RHEL
sudo yum install mysql-server mysql

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# é…ç½®MySQLï¼ˆå¯é€‰ï¼‰
sudo mysql_secure_installation
```

### 2. åˆå§‹åŒ–æ•°æ®åº“

#### 2.1 åˆ›å»ºMySQLæ•°æ®åº“
```bash
# ç™»å½•MySQL
mysql -u root -p

# åˆ›å»ºæ•°æ®åº“
CREATE DATABASE emotional_chat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# é€€å‡ºMySQL
exit;
```

#### 2.2 è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨Makefileï¼ˆæ¨èï¼‰
make db-init          # åˆå§‹åŒ–æ•°æ®åº“
make db-upgrade       # å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬

# æ–¹æ³•2ï¼šä½¿ç”¨Alembicå‘½ä»¤
alembic upgrade head  # å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬

# æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
make db-current       # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
make db-history       # æŸ¥çœ‹è¿ç§»å†å²
```

#### 2.3 åˆå§‹åŒ–RAGçŸ¥è¯†åº“ï¼ˆå¯é€‰ä½†æ¨èï¼‰
```bash
# ä½¿ç”¨Makefile
make rag-init

# æˆ–ç›´æ¥è¿è¡Œ
python init_rag_knowledge.py
```

### 3. å¯åŠ¨æœåŠ¡

#### 3.1 å¯åŠ¨åç«¯æœåŠ¡
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼Œé¿å…æ–‡ä»¶ç›‘è§†é™åˆ¶é—®é¢˜ï¼‰
python3 run_backend.py

# æ–¹æ³•2ï¼šç›´æ¥åœ¨backendç›®å½•å¯åŠ¨
cd backend
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

> **æ³¨æ„**ï¼šå¯åŠ¨è„šæœ¬ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° backend ç›®å½•è¿è¡Œï¼Œé¿å… watchfiles æ‰«æ frontend/node_modules å¯¼è‡´çš„æ–‡ä»¶ç›‘è§†é™åˆ¶é—®é¢˜ã€‚

åç«¯æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ï¼ŒAPIæ–‡æ¡£å¯åœ¨ `http://localhost:8000/docs` æŸ¥çœ‹ã€‚

#### 3.2 å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
# æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£
cd /home/emotional_chat/frontend

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£3000ï¼‰
npm start
```

å‰ç«¯åº”ç”¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨ã€‚


### 4. éªŒè¯æœåŠ¡

**æ£€æŸ¥åç«¯æœåŠ¡**
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health
# é¢„æœŸå“åº”åŒ…å«: version: "3.0.0", agent_enabled: true

# æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ï¼ˆäº†è§£æ¶æ„ï¼‰
curl http://localhost:8000/system/info

# æŸ¥çœ‹APIæ ¹è·¯å¾„
curl http://localhost:8000/
# é¢„æœŸå“åº”åŒ…å«: Agentæ™ºèƒ½æ ¸å¿ƒã€RAGçŸ¥è¯†åº“ç­‰åŠŸèƒ½åˆ—è¡¨

# æµ‹è¯•æ™®é€šèŠå¤©æ¥å£
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼", "user_id": "test_user"}'

# æµ‹è¯•Agentæ¥å£ï¼ˆå¦‚æœå¯ç”¨ï¼‰
curl -X POST http://localhost:8000/agent/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œæ€ä¹ˆåŠï¼Ÿ", "user_id": "test_user"}'

# æŸ¥çœ‹APIæ–‡æ¡£
open http://localhost:8000/docs  # æˆ–åœ¨æµè§ˆå™¨ä¸­è®¿é—®
```

**æ£€æŸ¥å‰ç«¯æœåŠ¡**
- æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
- åº”è¯¥èƒ½çœ‹åˆ°ç°ä»£åŒ–çš„èŠå¤©ç•Œé¢

**æ£€æŸ¥æ•°æ®åº“è¿æ¥**
```bash
# ä½¿ç”¨Makefile
make db-check

# æŸ¥çœ‹è¡¨ç»“æ„
mysql -u root -p emotional_chat -e "SHOW TABLES;"
```

**æ£€æŸ¥RAGçŸ¥è¯†åº“**
```bash
# æµ‹è¯•RAGç³»ç»Ÿ
make rag-test

# æˆ–æŸ¥çœ‹çŸ¥è¯†åº“çŠ¶æ€
curl http://localhost:8000/rag/status
```

### 5. ä½¿ç”¨è¯´æ˜

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
2. åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä½ çš„æƒ³æ³•å’Œæ„Ÿå—
3. æœºå™¨äººä¼šåˆ†æä½ çš„æƒ…æ„Ÿå¹¶ç»™å‡ºå…±æƒ…å›åº”
4. æ”¯æŒå¤šè½®å¯¹è¯ï¼Œæœºå™¨äººä¼šè®°ä½å¯¹è¯å†å²
5. æŸ¥çœ‹APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs

### 6. æ•…éšœæ’é™¤

**åç«¯å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ä¾èµ–å®‰è£…
pip3 list | grep fastapi

# æ‰‹åŠ¨å®‰è£…ä¾èµ–
pip3 install --user -r requirements.txt

# æ£€æŸ¥MySQLè¿æ¥
python3 setup_database.py
```

**å‰ç«¯å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
npm --version

# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
cd frontend
rm -rf node_modules package-lock.json
npm install
```

**ç«¯å£å†²çª**
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8000
netstat -tulpn | grep :3000

# æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
sudo kill -9 <PID>
```

## ğŸ¯ å¿«é€Ÿå¯åŠ¨æ€»ç»“

### æ–¹å¼ä¸€ï¼šä½¿ç”¨Makefileï¼ˆæ¨èï¼‰

```bash
# 1. å®‰è£…ä¾èµ–
make install

# 2. åˆå§‹åŒ–æ•°æ®åº“
make db-upgrade

# 3. åˆå§‹åŒ–RAGçŸ¥è¯†åº“ï¼ˆå¯é€‰ï¼‰
make rag-init

# 4. å¯åŠ¨åç«¯æœåŠ¡
make run
```

### æ–¹å¼äºŒï¼šä½¿ç”¨Docker Compose

```bash
# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…å«ç›‘æ§æ ˆï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### æ–¹å¼ä¸‰ï¼šä¼ ç»Ÿæ–¹å¼

**ç»ˆç«¯1 - å¯åŠ¨åç«¯ï¼š**
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼ˆæ¨èï¼‰
python3 run_backend.py

# æˆ–è€…ä½¿ç”¨uvicorn
cd backend
python3 -m uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

**ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯ï¼š**
```bash
cd frontend
npm start
```

### è®¿é—®åœ°å€

- ğŸŒ å‰ç«¯ç•Œé¢ï¼šhttp://localhost:3000
- ğŸ”Œ åç«¯APIï¼šhttp://localhost:8000
- ğŸ“– APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs
- ğŸ“Š ç³»ç»Ÿä¿¡æ¯ï¼šhttp://localhost:8000/system/info

### æµ‹è¯•ç³»ç»Ÿ

```bash
# æµ‹è¯•åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯
curl http://localhost:8000/

# æµ‹è¯•æ™®é€šèŠå¤©
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½", "user_id": "test_user"}'

# æµ‹è¯•AgentèŠå¤©ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰
curl -X POST http://localhost:8000/agent/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "æˆ‘æœ€è¿‘å‹åŠ›å¾ˆå¤§", "user_id": "test_user"}'

# æµ‹è¯•RAGçŸ¥è¯†åº“
curl -X POST http://localhost:8000/rag/search \
  -H "Content-Type: application/json" \
  -d '{"query": "å¦‚ä½•å‡å‹", "top_k": 3}'
```

### å¸¸ç”¨Makefileå‘½ä»¤

```bash
make help         # æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make db-check     # æ£€æŸ¥æ•°æ®åº“è¿æ¥
make db-current   # æŸ¥çœ‹å½“å‰æ•°æ®åº“ç‰ˆæœ¬
make rag-test     # æµ‹è¯•RAGç³»ç»Ÿ
make rag-demo     # RAGæ•ˆæœå¯¹æ¯”æ¼”ç¤º
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
emotional_chat/
â”œâ”€â”€ backend/                          # åç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                  
â”‚   â”œâ”€â”€ app.py                       # âœ… FastAPIåº”ç”¨å·¥å‚ï¼ˆä¸»å…¥å£ï¼‰
â”‚   â”œâ”€â”€ main.py                      # æ—§ç‰ˆä¸»ç¨‹åºï¼ˆå…¼å®¹æ€§ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ routers/                     # è·¯ç”±å±‚ - APIæ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chat.py                  # èŠå¤©æ¥å£
â”‚   â”‚   â”œâ”€â”€ memory.py                # è®°å¿†ç®¡ç†æ¥å£
â”‚   â”‚   â”œâ”€â”€ feedback.py              # åé¦ˆæ¥å£
â”‚   â”‚   â””â”€â”€ evaluation.py            # è¯„ä¼°æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                    # æœåŠ¡å±‚ - ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ chat_service.py          # èŠå¤©æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ memory_service.py        # è®°å¿†æœåŠ¡
â”‚   â”‚   â””â”€â”€ context_service.py       # ä¸Šä¸‹æ–‡æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ modules/                     # æ¨¡å—å±‚ - æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ agent/                   # âœ… Agentæ™ºèƒ½æ ¸å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ core/                # Agentæ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ agent_core.py    # æ€»æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ planner.py       # ä»»åŠ¡è§„åˆ’å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ tool_caller.py   # å·¥å…·è°ƒç”¨å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ memory_hub.py    # è®°å¿†ä¸­æ¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ reflector.py     # åæ€ä¼˜åŒ–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ services/            # AgentæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/             # Agentè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ models/              # Agentæ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ rag/                     # âœ… RAGçŸ¥è¯†åº“ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ core/                # RAGæ ¸å¿ƒ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge_base.py   # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ retriever.py        # æ£€ç´¢å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ services/            # RAGæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ routers/             # RAGè·¯ç”±
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ llm/                     # LLMæ¨¡å‹å°è£…
â”‚   â”‚       â””â”€â”€ qwen_client.py       # é€šä¹‰åƒé—®å®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                        # æ ¸å¿ƒå·¥å…·å’Œæ¥å£
â”‚   â”‚   â”œâ”€â”€ config.py                # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ interfaces.py            # æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ exceptions.py            # å¼‚å¸¸å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ factories.py             # å·¥å‚æ¨¡å¼
â”‚   â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ database.py                  # æ•°æ®åº“æ¨¡å‹ï¼ˆSQLAlchemyï¼‰
â”‚   â”œâ”€â”€ models.py                    # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ dependencies.py              # FastAPIä¾èµ–æ³¨å…¥
â”‚   â”œâ”€â”€ logging_config.py            # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ emotion_analyzer.py          # æƒ…æ„Ÿåˆ†æå™¨
â”‚   â”œâ”€â”€ vector_store.py              # å‘é‡æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ memory_manager.py            # è®°å¿†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ memory_extractor.py          # è®°å¿†æå–å™¨
â”‚   â”œâ”€â”€ context_assembler.py         # ä¸Šä¸‹æ–‡ç»„è£…å™¨
â”‚   â”œâ”€â”€ evaluation_engine.py         # è¯„ä¼°å¼•æ“
â”‚   â””â”€â”€ feedback_analyzer.py         # åé¦ˆåˆ†æå™¨
â”‚
â”œâ”€â”€ frontend/                         # å‰ç«¯ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ public/                      
â”‚   â”‚   â””â”€â”€ index.html               
â”‚   â”œâ”€â”€ src/                         
â”‚   â”‚   â”œâ”€â”€ App.js                   # Reactä¸»ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ index.js                 # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ index.css                # å…¨å±€æ ·å¼
â”‚   â”‚   â””â”€â”€ services/                
â”‚   â”‚       â””â”€â”€ ChatAPI.js           # APIè°ƒç”¨å°è£…
â”‚   â”œâ”€â”€ package.json                 
â”‚   â””â”€â”€ package-lock.json            
â”‚
â”œâ”€â”€ alembic/                          # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ versions/                    # è¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ env.py                       # Alembicç¯å¢ƒ
â”‚   â””â”€â”€ alembic.ini                  # Alembicé…ç½®
â”‚
â”œâ”€â”€ docs/                             # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ RAGå®æ–½æ­¥éª¤.md               # RAGç³»ç»Ÿæ–‡æ¡£
â”‚   â””â”€â”€ è®°å¿†ç³»ç»Ÿæ¶æ„.md              # è®°å¿†ç³»ç»Ÿæ–‡æ¡£
â”‚
â”œâ”€â”€ chroma_db/                        # ChromaDBå‘é‡æ•°æ®åº“å­˜å‚¨
â”œâ”€â”€ uploads/                          # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”œâ”€â”€ log/                              # æ—¥å¿—ç›®å½•
â”‚
â”œâ”€â”€ config.py                         # å…¨å±€é…ç½®
â”œâ”€â”€ config.env                        # ç¯å¢ƒå˜é‡é…ç½® âš ï¸ åŒ…å«å¯†é’¥
â”œâ”€â”€ env_example.txt                   # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ run_backend.py                    # åç«¯å¯åŠ¨è„šæœ¬
â”œâ”€â”€ init_rag_knowledge.py            # RAGçŸ¥è¯†åº“åˆå§‹åŒ–
â”œâ”€â”€ requirements.txt                  # Pythonä¾èµ–
â”œâ”€â”€ Makefile                          # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ Dockerfile                        # Dockeré•œåƒæ„å»º
â”œâ”€â”€ docker-compose.yml               # Dockerå®¹å™¨ç¼–æ’
â”œâ”€â”€ alembic.ini                      # Alembicé…ç½®
â”œâ”€â”€ AGENT_README.md                  # Agentæ¨¡å—æ–‡æ¡£
â”œâ”€â”€ LICENSE                           
â””â”€â”€ README.md                         # é¡¹ç›®æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

#### ğŸ”¥ åº”ç”¨å…¥å£

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `backend/app.py` | âœ… åº”ç”¨å·¥å‚ | FastAPIåº”ç”¨åˆ›å»ºå’Œé…ç½®ï¼ˆv3.0ï¼‰ |
| `backend/main.py` | æ—§ç‰ˆå…¥å£ | å…¼å®¹æ€§ä¿ç•™ |
| `run_backend.py` | å¯åŠ¨è„šæœ¬ | æ¨èçš„å¯åŠ¨æ–¹å¼ |

#### ğŸ“Š æ¶æ„å±‚çº§

| å±‚çº§ | ç›®å½• | è¯´æ˜ |
|------|------|------|
| è·¯ç”±å±‚ | `backend/routers/` | APIæ¥å£å®šä¹‰å’Œè¯·æ±‚åˆ†å‘ |
| æœåŠ¡å±‚ | `backend/services/` | ä¸šåŠ¡é€»è¾‘å°è£…å’Œç¼–æ’ |
| æ¨¡å—å±‚ | `backend/modules/` | Agentã€RAGã€LLMæ ¸å¿ƒæ¨¡å— |
| æ•°æ®å±‚ | `backend/database.py` | æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“æ“ä½œ |

#### ğŸ¤– æ ¸å¿ƒæ¨¡å—

| æ¨¡å— | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| Agentæ ¸å¿ƒ | `backend/modules/agent/` | æ™ºèƒ½è§„åˆ’ã€å·¥å…·è°ƒç”¨ã€è®°å¿†ç®¡ç† |
| RAGç³»ç»Ÿ | `backend/modules/rag/` | çŸ¥è¯†åº“ç®¡ç†å’Œæ£€ç´¢å¢å¼º |
| LLMå°è£… | `backend/modules/llm/` | é€šä¹‰åƒé—®APIå°è£… |

#### âš™ï¸ é…ç½®å’Œå·¥å…·

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `config.env` | ç¯å¢ƒå˜é‡ï¼ˆAPIå¯†é’¥ã€æ•°æ®åº“é…ç½®ï¼‰âš ï¸ ä¸è¦æäº¤ |
| `Makefile` | å‘½ä»¤è¡Œå·¥å…·ï¼ˆdb-init, rag-initç­‰ï¼‰ |
| `docker-compose.yml` | Dockerå®¹å™¨ç¼–æ’ï¼ˆå®Œæ•´ç›‘æ§æ ˆï¼‰ |
| `alembic/` | æ•°æ®åº“ç‰ˆæœ¬ç®¡ç† |

## ğŸ“¡ APIæ¥å£æ–‡æ¡£

### 1. æ ¹è·¯å¾„å’Œç³»ç»Ÿä¿¡æ¯
```bash
GET /
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "name": "å¿ƒè¯­æƒ…æ„Ÿé™ªä¼´æœºå™¨äºº",
  "version": "3.0.0",
  "status": "running",
  "features": [
    "æƒ…æ„Ÿåˆ†æ",
    "è®°å¿†ç³»ç»Ÿ",
    "ä¸Šä¸‹æ–‡ç®¡ç†",
    "å‘é‡æ•°æ®åº“",
    "LangChainé›†æˆ",
    "è‡ªåŠ¨è¯„ä¼°",
    "RAGçŸ¥è¯†åº“",
    "Agentæ™ºèƒ½æ ¸å¿ƒ"
  ],
  "architecture": "åˆ†å±‚æœåŠ¡æ¶æ„ + Agentæ ¸å¿ƒ",
  "agent_enabled": true
}
```

### 2. å¥åº·æ£€æŸ¥
```bash
GET /health
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "healthy",
  "timestamp": "2025-10-16T10:00:00.000000",
  "version": "3.0.0",
  "database": "connected",
  "vector_db": "ready",
  "memory_system": "enabled"
}
```

### 3. ç³»ç»Ÿæ¶æ„ä¿¡æ¯
```bash
GET /system/info
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "architecture": {
    "pattern": "åˆ†å±‚æœåŠ¡æ¶æ„ + Agentæ ¸å¿ƒ",
    "layers": ["è·¯ç”±å±‚", "æœåŠ¡å±‚", "æ ¸å¿ƒå±‚", "æ•°æ®å±‚"],
    "services": ["ChatService", "MemoryService", "ContextService", "AgentService"],
    "routers": ["chat", "memory", "feedback", "evaluation", "agent"]
  },
  "memory_system": {
    "enabled": true,
    "components": ["è®°å¿†æå–å™¨", "è®°å¿†ç®¡ç†å™¨", "ä¸Šä¸‹æ–‡ç»„è£…å™¨"],
    "storage": ["å‘é‡æ•°æ®åº“ (ChromaDB)", "å…³ç³»æ•°æ®åº“ (MySQL)"]
  },
  "agent_system": {
    "enabled": true,
    "components": [
      "Agent Core - æ ¸å¿ƒæ§åˆ¶å™¨",
      "Memory Hub - è®°å¿†ä¸­æ¢",
      "Planner - ä»»åŠ¡è§„åˆ’å™¨",
      "Tool Caller - å·¥å…·è°ƒç”¨å™¨",
      "Reflector - åæ€ä¼˜åŒ–å™¨"
    ]
  }
}
```

### 4. èŠå¤©æ¥å£
```bash
POST /chat
Content-Type: application/json

{
  "message": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼",
  "user_id": "test_user",
  "session_id": "optional-session-id"
}
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "response": "ä½ å¥½ï¼Œå¬åˆ°ä½ ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼ğŸ˜Š",
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "emotion": "happy",
  "suggestions": [
    "å¾ˆé«˜å…´çœ‹åˆ°ä½ è¿™ä¹ˆå¼€å¿ƒï¼",
    "æœ‰ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…æƒ³è¦åˆ†äº«å—ï¼Ÿ"
  ],
  "timestamp": "2025-10-10T16:57:50.584646"
}
```

### 5. AgentèŠå¤©æ¥å£ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰
```bash
POST /agent/chat
Content-Type: application/json

{
  "user_id": "user_123",
  "message": "æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œæ€ä¹ˆåŠï¼Ÿ"
}
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "code": 200,
  "data": {
    "success": true,
    "response": "æˆ‘ç†è§£ä½ çš„å›°æ‰°ã€‚ç¡çœ é—®é¢˜ç¡®å®å¾ˆå½±å“ç”Ÿæ´»è´¨é‡ã€‚æˆ‘ä¸ºä½ å‡†å¤‡äº†å‡ ä¸ªç§‘å­¦æœ‰æ•ˆçš„æ”¹å–„æ–¹æ³•...",
    "emotion": "ç„¦è™‘",
    "emotion_intensity": 7.5,
    "actions": [
      {
        "type": "tool_call",
        "tool": "recommend_meditation",
        "success": true,
        "result": "å·²æ¨è3ä¸ªåŠ©çœ å†¥æƒ³éŸ³é¢‘"
      }
    ],
    "followup_scheduled": true,
    "response_time": 1.2
  }
}
```

### 6. è·å–ä¼šè¯å†å²
```bash
GET /sessions/{session_id}/history?limit=20
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "messages": [
    {
      "role": "user",
      "content": "ä½ å¥½ï¼Œæˆ‘ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼",
      "emotion": "happy",
      "emotion_intensity": 8,
      "timestamp": "2025-10-10T16:57:50.000000"
    },
    {
      "role": "assistant",
      "content": "ä½ å¥½ï¼Œå¬åˆ°ä½ ä»Šå¤©å¿ƒæƒ…å¾ˆå¥½ï¼ŒçœŸæ˜¯å¤ªæ£’äº†ï¼ğŸ˜Š",
      "emotion": "empathetic",
      "timestamp": "2025-10-10T16:57:52.000000"
    }
  ]
}
```

### 7. è·å–ä¼šè¯æ‘˜è¦
```bash
GET /sessions/{session_id}/summary
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "session_id": "0ccdde5c-8592-4e23-893a-8e1a8d8bbaf7",
  "message_count": 10,
  "emotion_distribution": {
    "happy": 5,
    "neutral": 3,
    "anxious": 2
  },
  "created_at": "2025-10-10T16:57:50.000000",
  "updated_at": "2025-10-10T17:05:20.000000"
}
```

### 8. è·å–ç”¨æˆ·æƒ…æ„Ÿè¶‹åŠ¿
```bash
GET /users/{user_id}/emotion-trends
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "user_id": "test_user",
  "total_records": 50,
  "recent_emotions": ["happy", "neutral", "anxious"],
  "average_intensity": 6.5,
  "emotion_counts": {
    "happy": 20,
    "neutral": 15,
    "anxious": 10,
    "sad": 5
  }
}
```

### 9. RAGçŸ¥è¯†åº“æ£€ç´¢
```bash
POST /rag/search
Content-Type: application/json

{
  "query": "å¦‚ä½•æ”¹å–„ç¡çœ è´¨é‡ï¼Ÿ",
  "top_k": 3
}
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "query": "å¦‚ä½•æ”¹å–„ç¡çœ è´¨é‡ï¼Ÿ",
  "results": [
    {
      "content": "ç¡çœ å«ç”Ÿçš„é‡è¦æ€§ï¼šä¿æŒè§„å¾‹çš„ä½œæ¯æ—¶é—´ï¼Œç¡å‰é¿å…ä½¿ç”¨ç”µå­è®¾å¤‡...",
      "category": "ç¡çœ æ”¹å–„",
      "relevance_score": 0.92,
      "metadata": {
        "source": "å¿ƒç†å¥åº·çŸ¥è¯†åº“",
        "topic": "ç¡çœ ç®¡ç†"
      }
    }
  ]
}
```

### 10. RAGçŸ¥è¯†åº“çŠ¶æ€
```bash
GET /rag/status
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "ready",
  "total_documents": 50,
  "categories": [
    "è®¤çŸ¥è¡Œä¸ºç–—æ³•",
    "æ­£å¿µå‡å‹",
    "ç§¯æå¿ƒç†å­¦",
    "ç„¦è™‘åº”å¯¹",
    "ç¡çœ æ”¹å–„",
    "æƒ…ç»ªè°ƒèŠ‚"
  ],
  "last_updated": "2025-10-16T09:00:00.000000"
}
```

### 11. Agentå¯ç”¨å·¥å…·åˆ—è¡¨
```bash
GET /agent/tools
```
**å“åº”ç¤ºä¾‹:**
```json
{
  "tools": [
    {
      "name": "search_memory",
      "description": "æ£€ç´¢ç”¨æˆ·å†å²è®°å¿†",
      "category": "memory"
    },
    {
      "name": "recommend_meditation",
      "description": "æ¨èå†¥æƒ³éŸ³é¢‘",
      "category": "resource"
    },
    {
      "name": "set_reminder",
      "description": "è®¾ç½®æé†’",
      "category": "scheduler"
    }
  ]
}
```

### å®Œæ•´APIæ–‡æ¡£
è®¿é—® http://localhost:8000/docs æŸ¥çœ‹å®Œæ•´çš„äº¤äº’å¼APIæ–‡æ¡£ï¼ˆSwagger UIï¼‰

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. Agentæ™ºèƒ½æ ¸å¿ƒ

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·è¾“å…¥
  â†“
Planner åˆ†æç›®æ ‡ â†’ åˆ¶å®šç­–ç•¥
  â†“
Memory Hub æ£€ç´¢è®°å¿† â†’ æ„å»ºç”»åƒ
  â†“
Tool Caller æ‰§è¡Œå·¥å…· â†’ è·å–èµ„æº
  â†“
ç”Ÿæˆå›å¤ + æƒ…æ„Ÿåˆ†æ
  â†“
Reflector è¯„ä¼°æ•ˆæœ â†’ è§„åˆ’å›è®¿
```

**æ ¸å¿ƒèƒ½åŠ›**:
- âœ… æ™ºèƒ½ä»»åŠ¡åˆ†è§£å’Œè§„åˆ’
- âœ… 10+ å·¥å…·è‡ªåŠ¨è°ƒç”¨
- âœ… é•¿çŸ­æœŸè®°å¿†ç®¡ç†
- âœ… ç”¨æˆ·ç”»åƒæ„å»º
- âœ… ä¸»åŠ¨å›è®¿å…³æ€€
- âœ… ç­–ç•¥åæ€ä¼˜åŒ–

### 2. RAGçŸ¥è¯†å¢å¼º

**æ£€ç´¢æµç¨‹**:
```
ç”¨æˆ·é—®é¢˜
  â†“
é—®é¢˜åˆ†æ â†’ åˆ¤æ–­æ˜¯å¦éœ€è¦çŸ¥è¯†åº“
  â†“
å‘é‡æ£€ç´¢ â†’ æŸ¥æ‰¾ç›¸å…³çŸ¥è¯†
  â†“
çŸ¥è¯†èåˆ â†’ å¢å¼ºprompt
  â†“
ç”Ÿæˆå›å¤ï¼ˆåŸºäºçŸ¥è¯† + å…±æƒ…ï¼‰
```

**ç‰¹ç‚¹**:
- âœ… 6å¤§ç±»ä¸“ä¸šå¿ƒç†å¥åº·çŸ¥è¯†
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢
- âœ… è‡ªåŠ¨åˆ¤æ–­çŸ¥è¯†å¢å¼ºæ—¶æœº
- âœ… æ”¯æŒPDFç­‰å¤šç§æ ¼å¼å¯¼å…¥

### 3. æƒ…æ„Ÿåˆ†æç³»ç»Ÿ

**åˆ†æç»´åº¦**:
- æƒ…æ„Ÿç±»å‹ï¼šå¼€å¿ƒã€éš¾è¿‡ã€ç„¦è™‘ã€æ„¤æ€’ã€å¹³é™ç­‰
- æƒ…æ„Ÿå¼ºåº¦ï¼š0-10åˆ†é‡åŒ–è¯„ä¼°
- å…³é”®è¯æå–ï¼šè¯†åˆ«æƒ…ç»ªè§¦å‘è¯
- è¶‹åŠ¿åˆ†æï¼šè·¨ä¼šè¯æƒ…æ„Ÿå˜åŒ–è¿½è¸ª

**å®ç°æ–¹å¼**:
- ä½¿ç”¨é€šä¹‰åƒé—® API è¿›è¡Œæƒ…æ„Ÿç†è§£
- ç»“åˆå†å²æ•°æ®è¿›è¡Œæƒ…æ„Ÿæ¨¡å¼å­¦ä¹ 
- è‡ªåŠ¨è®°å½•æƒ…æ„Ÿåˆ†æç»“æœåˆ°æ•°æ®åº“

### 4. è®°å¿†ç³»ç»Ÿ

**ä¸‰å±‚è®°å¿†æ¶æ„**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  çŸ­æœŸè®°å¿† (Working Memory)       â”‚
â”‚  å½“å‰ä¼šè¯ä¸Šä¸‹æ–‡ï¼ˆæœ€è¿‘5-10æ¡ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é•¿æœŸè®°å¿† (Long-term Memory)     â”‚
â”‚  ChromaDBå‘é‡å­˜å‚¨ï¼ˆæ‰€æœ‰å†å²ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç”»åƒ (User Profile)         â”‚
â”‚  æ€§æ ¼ç‰¹å¾ã€åå¥½ã€æƒ…æ„ŸåŸºçº¿         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨è®°å¿†æå–å’Œå­˜å‚¨
- âœ… è¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢
- âœ… è·¨ä¼šè¯è®°å¿†è®¿é—®
- âœ… ç”¨æˆ·ç”»åƒè‡ªåŠ¨æ„å»º

### 5. è¯„ä¼°å’Œåé¦ˆç³»ç»Ÿ

**è‡ªåŠ¨è¯„ä¼°**:
- å›å¤è´¨é‡è¯„ä¼°ï¼ˆ1-5åˆ†ï¼‰
- å…±æƒ…åº¦è¯„ä¼°
- å®ç”¨æ€§è¯„ä¼°
- ç”¨æˆ·æ»¡æ„åº¦é¢„æµ‹

**åé¦ˆæ”¶é›†**:
- ç‚¹èµ/ç‚¹è¸©
- æ–‡å­—åé¦ˆ
- é—®é¢˜æ ‡æ³¨
- æ”¹è¿›å»ºè®®æ”¶é›†

## ğŸ”§ APIæ¥å£

### èŠå¤©æ¥å£
```http
POST http://localhost:8000/chat
Content-Type: application/json

{
  "message": "ç”¨æˆ·æ¶ˆæ¯",
  "session_id": "ä¼šè¯IDï¼ˆå¯é€‰ï¼‰",
  "user_id": "ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰"
}
```

### ä¼šè¯å†å²
```http
GET http://localhost:8000/sessions/{session_id}/history?limit=20
```

### ä¼šè¯æ‘˜è¦
```http
GET http://localhost:8000/sessions/{session_id}/summary
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

- ç°ä»£åŒ–çš„èŠå¤©ç•Œé¢è®¾è®¡
- æƒ…æ„Ÿæ ‡ç­¾å¯è§†åŒ–
- å»ºè®®æŒ‰é’®å¿«é€Ÿå›å¤
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯

## ğŸ”® æœªæ¥è§„åˆ’

### è¿‘æœŸè®¡åˆ’ï¼ˆv3.1.0ï¼‰
- [ ] Agentå·¥å…·åº“æ‰©å±•ï¼ˆ20+å·¥å…·ï¼‰
- [ ] çœŸå®çš„å®šæ—¶å›è®¿ç³»ç»Ÿï¼ˆAPSchedulerï¼‰
- [ ] ç”¨æˆ·åå¥½å­¦ä¹ å’Œä¸ªæ€§åŒ–æ¨è
- [ ] å¤šæ¨¡æ€æ”¯æŒï¼ˆå›¾ç‰‡ç†è§£ï¼‰
- [ ] è¯­éŸ³è½¬æ–‡å­—é›†æˆ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥

### ä¸­æœŸè®¡åˆ’ï¼ˆv3.5.0ï¼‰
- [ ] å¤šè¯­è¨€æ”¯æŒï¼ˆè‹±è¯­ã€æ—¥è¯­ï¼‰
- [ ] ä¸“ä¸šå’¨è¯¢å¸ˆå¯¹æ¥ç³»ç»Ÿ
- [ ] A/Bæµ‹è¯•æ¡†æ¶
- [ ] é«˜çº§æƒ…æ„Ÿè¶‹åŠ¿åˆ†æå’Œé¢„æµ‹
- [ ] ç¾¤ç»„èŠå¤©æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–

### é•¿æœŸè®¡åˆ’ï¼ˆv4.0.0ï¼‰
- [ ] è”é‚¦å­¦ä¹ ä¿æŠ¤éšç§
- [ ] æœ¬åœ°åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- [ ] ç§»åŠ¨ç«¯åŸç”ŸApp
- [ ] æ™ºèƒ½å¯ç©¿æˆ´è®¾å¤‡é›†æˆ
- [ ] å¿ƒç†å¥åº·ç”Ÿæ€ç³»ç»Ÿ
- [ ] å¼€æ”¾APIå¹³å°

## ğŸ“ ç‰ˆæœ¬å†å²

### v3.0.0 (2025-10-16) - å½“å‰ç‰ˆæœ¬
- âœ… Agentæ™ºèƒ½æ ¸å¿ƒç³»ç»Ÿ
- âœ… RAGçŸ¥è¯†åº“é›†æˆ
- âœ… åˆ†å±‚æœåŠ¡æ¶æ„é‡æ„
- âœ… Dockerå®¹å™¨åŒ–éƒ¨ç½²
- âœ… å®Œæ•´ç›‘æ§ä½“ç³»
- âœ… æ•°æ®åº“è¿ç§»ç®¡ç†ï¼ˆAlembicï¼‰
- âœ… è®°å¿†ç³»ç»Ÿå‡çº§
- âœ… è‡ªåŠ¨è¯„ä¼°ç³»ç»Ÿ

### v2.0.0 (2025-10-10)
- âœ… ä»OpenAIè¿ç§»åˆ°é˜¿é‡Œäº‘é€šä¹‰åƒé—®
- âœ… ChromaDBå‘é‡æ•°æ®åº“é›†æˆ
- âœ… LangChainè®°å¿†ç®¡ç†
- âœ… æƒ…æ„Ÿåˆ†æä¼˜åŒ–
- âœ… Reactå‰ç«¯ç•Œé¢

### v1.0.0 (2025-10-01)
- âœ… åŸºç¡€èŠå¤©åŠŸèƒ½
- âœ… MySQLæ•°æ®æŒä¹…åŒ–
- âœ… æƒ…æ„Ÿè¯†åˆ«
- âœ… ç®€å•çš„ä¸Šä¸‹æ–‡ç®¡ç†

## ğŸš€ ç”Ÿäº§éƒ¨ç½²

### æ–¹å¼ä¸€ï¼šDocker Compose éƒ¨ç½²ï¼ˆæ¨èï¼‰

é¡¹ç›®å·²é›†æˆå®Œæ•´çš„Dockerå®¹å™¨åŒ–æ–¹æ¡ˆï¼ŒåŒ…å«ç›‘æ§ã€æ—¥å¿—ã€ç¼“å­˜ç­‰å®Œæ•´æœåŠ¡æ ˆã€‚

#### 1. å‡†å¤‡ç¯å¢ƒå˜é‡
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env_example.txt .env

# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„é…ç½®
nano .env
```

#### 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
```bash
# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆï¼ˆåŒ…å«ç›‘æ§ï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend
```

#### 3. æœåŠ¡è®¿é—®
```
- åç«¯API:        http://localhost:8000
- å‰ç«¯ç•Œé¢:       http://localhost:3000
- APIæ–‡æ¡£:        http://localhost:8000/docs
- Prometheus:     http://localhost:9090
- Grafana:        http://localhost:3000 (admin/admin)
- Kibana:         http://localhost:5601
```

#### 4. åœæ­¢æœåŠ¡
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶æ¸…ç†æ•°æ®å·
docker-compose down -v
```

### æ–¹å¼äºŒï¼šä¼ ç»Ÿéƒ¨ç½²

### éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] é…ç½®ç”Ÿäº§ç¯å¢ƒçš„`config.env`æ–‡ä»¶
- [ ] æ›´æ–°CORSå…è®¸çš„åŸŸåï¼ˆä¸è¦ä½¿ç”¨`*`ï¼‰
- [ ] é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
- [ ] å¯ç”¨HTTPS/SSLè¯ä¹¦
- [ ] é…ç½®æ•°æ®åº“å¤‡ä»½ç­–ç•¥
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®ç›‘æ§å’Œå‘Šè­¦
- [ ] åˆå§‹åŒ–æ•°æ®åº“ï¼ˆ`make db-upgrade`ï¼‰
- [ ] åˆå§‹åŒ–RAGçŸ¥è¯†åº“ï¼ˆ`make rag-init`ï¼‰

### Nginxé…ç½®ç¤ºä¾‹

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://localhost:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### æ•°æ®åº“å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p emotional_chat > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u root -p emotional_chat < backup_20251010.sql

# è®¾ç½®è‡ªåŠ¨å¤‡ä»½ï¼ˆcrontabï¼‰
0 2 * * * mysqldump -u root -p[password] emotional_chat > /backup/emotional_chat_$(date +\%Y\%m\%d).sql
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### ç³»ç»Ÿç›‘æ§

```bash
# æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æŸ¥çœ‹MySQLè¿æ¥æ•°
mysql -u root -p -e "SHOW STATUS LIKE 'Threads_connected';"

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
mysql -u root -p -e "SELECT table_schema AS 'Database', ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Size (MB)' FROM information_schema.tables WHERE table_schema = 'emotional_chat' GROUP BY table_schema;"
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼ˆå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰
mysql -u root -p -e "SELECT * FROM emotional_chat.system_logs ORDER BY created_at DESC LIMIT 20;"

# æŸ¥çœ‹ç”¨æˆ·æ´»è·ƒåº¦
mysql -u root -p -e "SELECT DATE(created_at) as date, COUNT(DISTINCT user_id) as active_users FROM emotional_chat.chat_messages GROUP BY DATE(created_at) ORDER BY date DESC LIMIT 7;"

# æŸ¥çœ‹æƒ…æ„Ÿåˆ†å¸ƒç»Ÿè®¡
mysql -u root -p -e "SELECT emotion, COUNT(*) as count FROM emotional_chat.chat_messages WHERE emotion IS NOT NULL GROUP BY emotion ORDER BY count DESC;"
```

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ› ï¸ Makefile å‘½ä»¤é€ŸæŸ¥

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„Makefileå‘½ä»¤ï¼Œç®€åŒ–å¸¸ç”¨æ“ä½œï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# å®‰è£…ä¾èµ–
make install

# æ•°æ®åº“ç®¡ç†
make db-init          # åˆå§‹åŒ–æ•°æ®åº“
make db-upgrade       # å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
make db-downgrade     # é™çº§ä¸€ä¸ªç‰ˆæœ¬
make db-current       # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
make db-history       # æŸ¥çœ‹è¿ç§»å†å²
make db-check         # æ£€æŸ¥æ•°æ®åº“è¿æ¥

# RAGçŸ¥è¯†åº“
make rag-init         # åˆå§‹åŒ–çŸ¥è¯†åº“
make rag-test         # æµ‹è¯•RAGç³»ç»Ÿ
make rag-demo         # RAGæ•ˆæœå¯¹æ¯”æ¼”ç¤º

# è¿è¡ŒæœåŠ¡
make run              # å¯åŠ¨åç«¯æœåŠ¡
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **Agentæ¨¡å—**: [AGENT_README.md](AGENT_README.md) - Agentæ™ºèƒ½æ ¸å¿ƒè¯¦ç»†æ–‡æ¡£
- **RAGç³»ç»Ÿ**: [docs/RAGå®æ–½æ­¥éª¤.md](docs/RAGå®æ–½æ­¥éª¤.md) - RAGçŸ¥è¯†åº“å®æ–½æŒ‡å—
- **è®°å¿†ç³»ç»Ÿ**: [docs/è®°å¿†ç³»ç»Ÿæ¶æ„.md](docs/è®°å¿†ç³»ç»Ÿæ¶æ„.md) - è®°å¿†ç³»ç»Ÿæ¶æ„è¯´æ˜
- **APIæ–‡æ¡£**: http://localhost:8000/docs - äº¤äº’å¼APIæ–‡æ¡£ï¼ˆSwagger UIï¼‰

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

### è´¡çŒ®æ–¹å¼
1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘è§„èŒƒ
- éµå¾ªPEP 8 Pythonä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ™ è‡´è°¢

- [emotional_chat](https://github.com/congde/emotional_chat.git) - åŸå§‹é¡¹ç›®å‚è€ƒ
- é˜¿é‡Œäº‘é€šä¹‰åƒé—®å›¢é˜Ÿ - æä¾›ä¼˜ç§€çš„ä¸­æ–‡å¤§è¯­è¨€æ¨¡å‹
- LangChainç¤¾åŒº - æä¾›å¼ºå¤§çš„LLMåº”ç”¨æ¡†æ¶
- æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒ

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ GitHub Issue
- å‘é€é‚®ä»¶åˆ°é¡¹ç›®ç»´æŠ¤è€…

---

ğŸ’ **è®©AIæ›´æœ‰æ¸©åº¦ï¼Œè®©é™ªä¼´æ›´æ‡‚ä½ ** ğŸ’

**å¿ƒè¯­æƒ…æ„Ÿé™ªä¼´æœºå™¨äºº v3.0.0** - ä»è¢«åŠ¨å“åº”åˆ°ä¸»åŠ¨æœåŠ¡ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è¿›åŒ–ã€‚
