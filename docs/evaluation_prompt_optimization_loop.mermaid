graph TD
    Start([开始: 当前Prompt]) --> Eval1[评估测试<br/>使用标准测试用例]
    
    Eval1 --> Score1{基准分数<br/>3.8/5.0}
    
    Score1 --> Analysis[分析评估反馈]
    
    Analysis --> Weak[识别主要缺点]
    Weak --> Weak1[❌ 共情不够深入]
    Weak --> Weak2[❌ 回应过于简短]
    Weak --> Weak3[❌ 缺乏具体支持]
    
    Weak1 --> Improve[基于建议优化Prompt]
    Weak2 --> Improve
    Weak3 --> Improve
    
    Improve --> V2[创建 Prompt v2]
    
    V2 --> AB[A/B对比测试]
    
    AB --> Compare{对比评分}
    Compare --> V1Score[v1: 3.8分<br/>共情3.5 自然4.0 安全4.0]
    Compare --> V2Score[v2: 4.3分<br/>共情4.5 自然4.2 安全4.2]
    
    V2Score --> Decision{v2 是否<br/>明显更优?}
    
    Decision -->|是<br/>提升>0.3分| Deploy[部署新版本]
    Decision -->|否<br/>提升<0.3分| Iterate[继续迭代优化]
    
    Deploy --> Monitor[持续监控]
    
    Monitor --> Check{质量<br/>是否稳定?}
    Check -->|是| Maintain[保持当前版本]
    Check -->|否<br/>分数下降| Alert[触发告警]
    
    Alert --> RootCause[分析原因]
    RootCause --> Eval1
    
    Iterate --> V3[创建 Prompt v3]
    V3 --> AB
    
    Maintain --> Schedule[定期评估]
    Schedule --> Weekly[每周批量评估]
    Weekly --> Eval1
    
    style Start fill:#e1f5ff
    style Score1 fill:#fff4e1
    style Decision fill:#ffebee
    style Deploy fill:#e8f5e9
    style Alert fill:#ffcdd2
    style V2Score fill:#c8e6c9
    style Maintain fill:#dcedc8
    
    classDef weaknessStyle fill:#ffebee,stroke:#f44336
    class Weak1,Weak2,Weak3 weaknessStyle

