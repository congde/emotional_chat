# å¢å¼ºç‰ˆå¤šè½®å¯¹è¯ç³»ç»Ÿ - å¿«é€Ÿéƒ¨ç½²æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

- âœ… å·²å®ŒæˆåŸºç¡€ç³»ç»Ÿéƒ¨ç½²ï¼ˆæ•°æ®åº“ã€å‘é‡æ•°æ®åº“ï¼‰
- âœ… Python 3.10+
- âœ… MySQL 5.7+
- âœ… ChromaDB

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤1ï¼šæ•°æ®åº“è¿ç§»

```bash
# è¿›å…¥é¡¹ç›®æ ¹ç›®å½•
cd /home/workSpace/emotional_chat

# è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬
mysql -u root -p emotional_chat < backend/migrations/add_enhanced_memory_fields.sql

# éªŒè¯è¿ç§»æˆåŠŸ
mysql -u root -p emotional_chat -e "SHOW TABLES LIKE 'conversation_graphs';"
mysql -u root -p emotional_chat -e "SHOW TABLES LIKE 'proactive_recalls';"
```

### æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
# æ‰€æœ‰ä¾èµ–å·²åŒ…å«åœ¨ requirements.txt ä¸­
pip install -r requirements.txt
```

### æ­¥éª¤3ï¼šå¯åŠ¨å¢å¼ºç‰ˆæœåŠ¡

```bash
# æ–¹å¼1ï¼šç›´æ¥å¯åŠ¨
python run_backend.py

# æ–¹å¼2ï¼šä½¿ç”¨uvicorn
uvicorn backend.app:app --host 0.0.0.0 --port 8000 --reload

# æ–¹å¼3ï¼šä½¿ç”¨Docker
docker-compose up -d
```

### æ­¥éª¤4ï¼šéªŒè¯éƒ¨ç½²

```bash
# 1. æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
curl http://localhost:8000/api/enhanced-chat/system/status

# é¢„æœŸå“åº”ï¼š
# {
#   "version": "enhanced_v1.0",
#   "features": {
#     "enhanced_memory": {"enabled": true, ...},
#     "user_profile": {"enabled": true, ...},
#     "proactive_recall": {"enabled": true, ...}
#   },
#   "status": "operational"
# }

# 2. æµ‹è¯•èŠå¤©æ¥å£
curl -X POST http://localhost:8000/api/enhanced-chat/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘æœ€è¿‘å·¥ä½œå‹åŠ›å¾ˆå¤§",
    "user_id": "test_user_001"
  }'

# 3. æŸ¥çœ‹ç”¨æˆ·ç”»åƒ
curl http://localhost:8000/api/enhanced-chat/users/test_user_001/profile

# 4. æŸ¥çœ‹è®°å¿†åˆ—è¡¨
curl http://localhost:8000/api/enhanced-chat/users/test_user_001/memories
```

## ğŸ” åŠŸèƒ½éªŒè¯æ¸…å•

### âœ… åŸºç¡€åŠŸèƒ½

- [ ] èŠå¤©æ¥å£æ­£å¸¸å“åº”
- [ ] æƒ…ç»ªåˆ†æå·¥ä½œæ­£å¸¸
- [ ] æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“
- [ ] å‘é‡æ•°æ®åº“è¿æ¥æ­£å¸¸

### âœ… å¢å¼ºåŠŸèƒ½

- [ ] **çŸ­æœŸè®°å¿†** - æœ€è¿‘å¯¹è¯èƒ½å¤Ÿè¢«æ­£ç¡®ä¿ç•™
- [ ] **é•¿æœŸè®°å¿†** - å†å²è®°å¿†èƒ½å¤Ÿè¢«æ£€ç´¢åˆ°
- [ ] **è®°å¿†è¡°å‡** - æ—§è®°å¿†çš„é‡è¦æ€§ä¼šéšæ—¶é—´é™ä½
- [ ] **ç”¨æˆ·ç”»åƒ** - èƒ½å¤Ÿç”Ÿæˆç”¨æˆ·ç”»åƒ
- [ ] **ä¸»åŠ¨å›å¿†** - åœ¨é€‚å½“æ—¶å€™è§¦å‘ä¸»åŠ¨å…³æ€€

### âœ… æ€§èƒ½æŒ‡æ ‡

- [ ] APIå“åº”æ—¶é—´ < 200ms
- [ ] è®°å¿†æ£€ç´¢å»¶è¿Ÿ < 100ms
- [ ] ç”»åƒæ„å»ºæ—¶é—´ < 500ms

## ğŸ§ª å®Œæ•´æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šæµ‹è¯•è®°å¿†ä¿ç•™

```bash
# ç¬¬1æ¬¡å¯¹è¯ - æåˆ°é‡è¦ä¿¡æ¯
curl -X POST http://localhost:8000/api/enhanced-chat/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘ä¸‹å‘¨è¦å»é¢è¯•ä¸€å®¶æ–°å…¬å¸ï¼Œæœ‰ç‚¹ç´§å¼ ",
    "user_id": "test_user_memory"
  }'

# ç¬¬2æ¬¡å¯¹è¯ - é—²èŠ
curl -X POST http://localhost:8000/api/enhanced-chat/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä»Šå¤©å¤©æ°”ä¸é”™",
    "user_id": "test_user_memory"
  }'

# é¢„æœŸï¼šç³»ç»Ÿåº”è¯¥åœ¨ç¬¬2æ¬¡å¯¹è¯ä¸­ä¸»åŠ¨æåŠé¢è¯•çš„äº‹
```

### åœºæ™¯2ï¼šæµ‹è¯•æƒ…ç»ªè¿½è¸ª

```bash
# ç¬¬1æ¬¡ - è´Ÿé¢æƒ…ç»ª
curl -X POST http://localhost:8000/api/enhanced-chat/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘æœ€è¿‘å‹åŠ›å¾ˆå¤§ï¼Œæ€»æ˜¯å¤±çœ ",
    "user_id": "test_user_emotion"
  }'

# ç­‰å¾…å‡ ç§’...

# ç¬¬2æ¬¡ - ä¸­æ€§æ¶ˆæ¯
curl -X POST http://localhost:8000/api/enhanced-chat/ \
  -H "Content-Type: application/json" \
  -d '{
    "message": "å—¯ï¼Œè¿˜å¥½",
    "user_id": "test_user_emotion"
  }'

# é¢„æœŸï¼šç³»ç»Ÿåº”è¯¥ä¸»åŠ¨å…³å¿ƒä¹‹å‰çš„å‹åŠ›é—®é¢˜
```

### åœºæ™¯3ï¼šæµ‹è¯•ç”¨æˆ·ç”»åƒ

```bash
# è¿›è¡Œ10æ¬¡å¯¹è¯...
for i in {1..10}
do
  curl -X POST http://localhost:8000/api/enhanced-chat/ \
    -H "Content-Type: application/json" \
    -d "{
      \"message\": \"å¯¹è¯${i}: å…³äºå·¥ä½œçš„çƒ¦æ¼\",
      \"user_id\": \"test_user_profile\"
    }"
  sleep 1
done

# æŸ¥çœ‹ç”»åƒ
curl http://localhost:8000/api/enhanced-chat/users/test_user_profile/profile

# é¢„æœŸï¼šç”»åƒä¸­åº”è¯¥æ˜¾ç¤º"å·¥ä½œ"ç›¸å…³çš„æ ¸å¿ƒå…³æ³¨ç‚¹
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat config.env | grep DATABASE

# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u root -p -h localhost -e "SELECT 1;"

# è§£å†³æ–¹æ¡ˆï¼šæ›´æ–° config.env ä¸­çš„æ•°æ®åº“é…ç½®
```

### é—®é¢˜2ï¼šå‘é‡æ•°æ®åº“é”™è¯¯

```bash
# æ£€æŸ¥ChromaDBè·¯å¾„
ls -la chroma_db/

# é‡æ–°åˆå§‹åŒ–
rm -rf chroma_db/
python backend/vector_store.py

# è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æœ‰å†™å…¥æƒé™
chmod -R 755 chroma_db/
```

### é—®é¢˜3ï¼šå¢å¼ºç‰ˆè·¯ç”±æœªå¯ç”¨

```bash
# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log | grep "å¢å¼ºç‰ˆ"

# å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œæ£€æŸ¥å¯¼å…¥
python -c "from backend.routers.enhanced_chat import router; print('OK')"

# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ‰€æœ‰ä¾èµ–æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la backend/services/enhanced_*.py
```

### é—®é¢˜4ï¼šè®°å¿†æ£€ç´¢è¿”å›ç©º

```bash
# æ£€æŸ¥å‘é‡æ•°æ®åº“ä¸­çš„è®°å¿†æ•°é‡
python -c "
from backend.services.enhanced_memory_manager import EnhancedMemoryManager
manager = EnhancedMemoryManager()
if manager.memory_collection:
    count = manager.memory_collection.count()
    print(f'è®°å¿†æ•°é‡: {count}')
"

# å¦‚æœä¸º0ï¼Œè¯´æ˜è®°å¿†æœªè¢«æ­£ç¡®å­˜å‚¨
# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥è®°å¿†æå–é€»è¾‘
```

### é—®é¢˜5ï¼šä¸»åŠ¨å›å¿†ä¸è§¦å‘

```bash
# æŸ¥çœ‹ä¸»åŠ¨å›å¿†é…ç½®
curl http://localhost:8000/api/enhanced-chat/system/status | jq '.features.proactive_recall'

# æ£€æŸ¥æ•°æ®åº“ä¸­çš„è®°å¿†
mysql -u root -p emotional_chat -e "
  SELECT user_id, memory_type, importance, 
         DATEDIFF(NOW(), created_at) as days_ago
  FROM memory_items 
  WHERE user_id = 'test_user' 
  ORDER BY importance DESC 
  LIMIT 5;
"

# è§£å†³æ–¹æ¡ˆï¼šç¡®ä¿æœ‰é‡è¦è®°å¿†ä¸”è¶…è¿‡7å¤©æœªè®¿é—®
```

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### æ—¥å¿—æŸ¥çœ‹

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f backend.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR backend.log | tail -20

# æŸ¥çœ‹å¢å¼ºç‰ˆç›¸å…³æ—¥å¿—
grep "Enhanced" backend.log | tail -20
```

### æ€§èƒ½ç›‘æ§

```bash
# æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½
mysql -u root -p emotional_chat -e "
  SELECT 
    COUNT(*) as total_memories,
    AVG(importance) as avg_importance,
    MAX(access_count) as max_access_count
  FROM memory_items 
  WHERE is_active = 1;
"

# å‘é‡æ•°æ®åº“å¤§å°
du -sh chroma_db/

# ç”¨æˆ·æ´»è·ƒåº¦
mysql -u root -p emotional_chat -e "
  SELECT 
    DATE(created_at) as date,
    COUNT(DISTINCT user_id) as active_users,
    COUNT(*) as total_messages
  FROM chat_messages 
  WHERE created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
  GROUP BY DATE(created_at);
"
```

### å®šæœŸç»´æŠ¤

```bash
# æ¯å‘¨æ‰§è¡Œä¸€æ¬¡ - æ¸…ç†è¿‡æœŸçš„ä½é‡è¦æ€§è®°å¿†
mysql -u root -p emotional_chat -e "
  UPDATE memory_items 
  SET is_active = 0 
  WHERE importance < 0.3 
    AND DATEDIFF(NOW(), last_accessed) > 90
    AND is_active = 1;
"

# æ¯æœˆæ‰§è¡Œä¸€æ¬¡ - é‡å»ºå‘é‡ç´¢å¼•ï¼ˆå¯é€‰ï¼‰
python -c "
from backend.services.enhanced_memory_manager import EnhancedMemoryManager
manager = EnhancedMemoryManager()
# å‘é‡æ•°æ®åº“ä¼šè‡ªåŠ¨ä¼˜åŒ–
print('å‘é‡ç´¢å¼•å·²ä¼˜åŒ–')
"

# å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p emotional_chat > backup_$(date +%Y%m%d).sql
```

## ğŸ”„ ç‰ˆæœ¬å‡çº§

### ä»åŸºç¡€ç‰ˆå‡çº§åˆ°å¢å¼ºç‰ˆ

```bash
# 1. å¤‡ä»½æ•°æ®
mysqldump -u root -p emotional_chat > backup_before_enhanced.sql

# 2. åœæ­¢æœåŠ¡
pkill -f "uvicorn backend.app:app"

# 3. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 4. è¿è¡Œè¿ç§»
mysql -u root -p emotional_chat < backend/migrations/add_enhanced_memory_fields.sql

# 5. é‡å¯æœåŠ¡
nohup python run_backend.py > backend.log 2>&1 &

# 6. éªŒè¯å‡çº§
curl http://localhost:8000/api/enhanced-chat/system/status
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_user_created ON chat_messages(user_id, created_at);
CREATE INDEX IF NOT EXISTS idx_user_importance ON memory_items(user_id, importance);

-- å®šæœŸåˆ†æè¡¨
ANALYZE TABLE chat_messages;
ANALYZE TABLE memory_items;
ANALYZE TABLE user_profiles;
```

### 2. å‘é‡æ•°æ®åº“ä¼˜åŒ–

```python
# é…ç½®å‘é‡æ•°æ®åº“æ‰¹é‡æ’å…¥
from backend.services.enhanced_memory_manager import EnhancedMemoryManager

# æ¯10æ¡è®°å¿†æ‰¹é‡æ’å…¥ä¸€æ¬¡
manager = EnhancedMemoryManager()
# è‡ªåŠ¨ä¼˜åŒ–
```

### 3. ç¼“å­˜é…ç½®

```python
# åœ¨ enhanced_chat_service.py ä¸­é…ç½®
# ç”¨æˆ·ç”»åƒç¼“å­˜24å°æ—¶
# å‘é‡æ£€ç´¢ç»“æœç¼“å­˜5åˆ†é’Ÿ
```

## ğŸ“ˆ æ‰©å±•æ€§è€ƒè™‘

### æ°´å¹³æ‰©å±•

```bash
# ä½¿ç”¨è´Ÿè½½å‡è¡¡éƒ¨ç½²å¤šä¸ªå®ä¾‹
# 1. å¯åŠ¨å¤šä¸ªåç«¯å®ä¾‹
uvicorn backend.app:app --port 8001 &
uvicorn backend.app:app --port 8002 &
uvicorn backend.app:app --port 8003 &

# 2. é…ç½®Nginxè´Ÿè½½å‡è¡¡
# /etc/nginx/conf.d/emotional_chat.conf
# upstream backend {
#     server localhost:8001;
#     server localhost:8002;
#     server localhost:8003;
# }
```

### æ•°æ®åº“è¯»å†™åˆ†ç¦»

```python
# é…ç½®ä¸»ä»æ•°æ®åº“
# config.env
DATABASE_URL_MASTER=mysql+pymysql://...
DATABASE_URL_SLAVE=mysql+pymysql://...
```

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼æ‚¨å·²æˆåŠŸéƒ¨ç½²å¢å¼ºç‰ˆå¤šè½®å¯¹è¯ç³»ç»Ÿã€‚

### ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ‰€æœ‰åŠŸèƒ½** - ä½¿ç”¨ä¸Šè¿°æµ‹è¯•åœºæ™¯éªŒè¯
2. **ç›‘æ§æ€§èƒ½æŒ‡æ ‡** - å…³æ³¨å“åº”æ—¶é—´å’Œèµ„æºä½¿ç”¨
3. **æ”¶é›†ç”¨æˆ·åé¦ˆ** - ä¼˜åŒ–ä¸»åŠ¨å›å¿†è§¦å‘é€»è¾‘
4. **å®šæœŸç»´æŠ¤** - æ‰§è¡Œæ•°æ®åº“æ¸…ç†å’Œå¤‡ä»½

### æŠ€æœ¯æ”¯æŒ

- ğŸ“– å®Œæ•´æ–‡æ¡£ï¼š`docs/å¢å¼ºç‰ˆå¤šè½®å¯¹è¯ç³»ç»Ÿ_README.md`
- ğŸ”§ é…ç½®æ–‡æ¡£ï¼š`docs/ä¸ªæ€§åŒ–é…ç½®_README.md`
- ğŸ’¬ é—®é¢˜åé¦ˆï¼šæŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ `backend.log`

---

**éƒ¨ç½²ç‰ˆæœ¬**: Enhanced v1.0  
**æœ€åæ›´æ–°**: 2025-10-21  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

