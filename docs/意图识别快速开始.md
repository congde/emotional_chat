# æ„å›¾è¯†åˆ«æ¨¡å— - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“š ç›®å½•

- [ç®€ä»‹](#ç®€ä»‹)
- [å®‰è£…](#å®‰è£…)
- [åŸºæœ¬ä½¿ç”¨](#åŸºæœ¬ä½¿ç”¨)
- [APIæ¥å£](#apiæ¥å£)
- [é›†æˆåˆ°é¡¹ç›®](#é›†æˆåˆ°é¡¹ç›®)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ç®€ä»‹

æ„å›¾è¯†åˆ«æ¨¡å—æ˜¯"å¿ƒè¯­"æƒ…æ„Ÿé™ªä¼´æœºå™¨äººçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«ç”¨æˆ·çš„çœŸå®æ„å›¾ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ˜Š **æƒ…æ„Ÿè¡¨è¾¾** - ç”¨æˆ·å€¾è¯‰æƒ…ç»ª
- ğŸ’¡ **å¯»æ±‚å»ºè®®** - è¯·æ±‚è§£å†³æ–¹æ¡ˆ
- ğŸ’¬ **æ™®é€šå¯¹è¯** - æ—¥å¸¸äº¤æµ
- âš™ï¸ **åŠŸèƒ½è¯·æ±‚** - æé†’ã€è®°å½•ç­‰
- ğŸš¨ **å±æœºå¹²é¢„** - ç´§æ€¥æƒ…å†µ âš ï¸
- ğŸ‘‹ **é—²èŠ** - æ‰“æ‹›å‘¼ã€å¯’æš„

## å®‰è£…

æ„å›¾è¯†åˆ«æ¨¡å—å·²ç»é›†æˆåˆ°ä¸»é¡¹ç›®ä¸­ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚

```bash
# ç¡®ä¿å·²å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

## åŸºæœ¬ä½¿ç”¨

### Pythonä»£ç ä½¿ç”¨

```python
from backend.modules.intent.services import IntentService

# åˆå§‹åŒ–æœåŠ¡
intent_service = IntentService()

# åˆ†æç”¨æˆ·è¾“å…¥
text = "æˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ"
result = intent_service.analyze(text, user_id="user_123")

# æŸ¥çœ‹ç»“æœ
print(f"æ„å›¾: {result['intent']['intent']}")
print(f"ç½®ä¿¡åº¦: {result['intent']['confidence']}")
print(f"æ¥æº: {result['intent']['source']}")

# å¦‚æœæ£€æµ‹åˆ°å±æœºæƒ…å†µ
if result['action_required']:
    print("âš ï¸ éœ€è¦ç‰¹æ®Šå…³æ³¨ï¼")
```

### è¿è¡Œç¤ºä¾‹

```bash
# è¿è¡Œä½¿ç”¨ç¤ºä¾‹
python3 examples/intent_recognition_demo.py

# è¿è¡Œæµ‹è¯•å¥—ä»¶
python3 test_intent_module.py
```

## APIæ¥å£

### 1. åˆ†ææ„å›¾

**ç«¯ç‚¹**: `POST /intent/analyze`

**è¯·æ±‚**:
```bash
curl -X POST http://localhost:8000/intent/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "text": "æˆ‘æœ€è¿‘ç¡ä¸å¥½ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ",
    "user_id": "user_123"
  }'
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "æ„å›¾è¯†åˆ«æˆåŠŸ",
  "data": {
    "success": true,
    "intent": {
      "intent": "advice",
      "confidence": 0.85,
      "source": "model"
    },
    "action_required": false,
    "suggestion": {
      "response_style": "å»ºè®¾æ€§ã€å®ç”¨ã€æ¸©å’Œ",
      "priority": "medium",
      "actions": ["åˆ†æé—®é¢˜", "æä¾›å¤šä¸ªé€‰æ‹©", "åˆ†äº«ç›¸å…³çŸ¥è¯†"]
    }
  }
}
```

### 2. å¿«é€Ÿæ£€æµ‹

**ç«¯ç‚¹**: `POST /intent/detect?text=ä½ å¥½`

```bash
curl -X POST "http://localhost:8000/intent/detect?text=ä½ å¥½"
```

### 3. è·å–æ„å›¾ç±»å‹

**ç«¯ç‚¹**: `GET /intent/types`

```bash
curl http://localhost:8000/intent/types
```

### 4. æœåŠ¡çŠ¶æ€

**ç«¯ç‚¹**: `GET /intent/status`

```bash
curl http://localhost:8000/intent/status
```

### 5. æ‰¹é‡åˆ†æ

**ç«¯ç‚¹**: `POST /intent/batch`

```bash
curl -X POST http://localhost:8000/intent/batch \
  -H "Content-Type: application/json" \
  -d '{
    "texts": ["ä½ å¥½", "æˆ‘å¾ˆéš¾è¿‡", "è¯¥æ€ä¹ˆåŠï¼Ÿ"]
  }'
```

## é›†æˆåˆ°é¡¹ç›®

### åœ¨èŠå¤©æœåŠ¡ä¸­ä½¿ç”¨

æ„å›¾è¯†åˆ«å·²ç»è‡ªåŠ¨é›†æˆåˆ° `ChatService` ä¸­ï¼š

```python
from backend.services.chat_service import ChatService

# åˆå§‹åŒ–èŠå¤©æœåŠ¡ï¼ˆé»˜è®¤å¯ç”¨æ„å›¾è¯†åˆ«ï¼‰
chat_service = ChatService(use_intent=True)

# å¤„ç†ç”¨æˆ·æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œæ„å›¾è¯†åˆ«
response = await chat_service.chat(request)

# å“åº”ä¸­ä¼šåŒ…å«æ„å›¾ä¿¡æ¯
print(response.context['intent'])  # æ„å›¾ç±»å‹
print(response.context['intent_confidence'])  # ç½®ä¿¡åº¦
```

### è‡ªå®šä¹‰é›†æˆ

```python
from backend.modules.intent.services import IntentService

class MyService:
    def __init__(self):
        self.intent_service = IntentService()
    
    async def process_message(self, message: str, user_id: str):
        # 1. æ„å›¾è¯†åˆ«
        intent_analysis = self.intent_service.analyze(message, user_id)
        
        # 2. æ£€æŸ¥å±æœºæƒ…å†µ
        if intent_analysis['action_required']:
            return await self.handle_crisis(intent_analysis)
        
        # 3. æ ¹æ®æ„å›¾é€‰æ‹©å¤„ç†ç­–ç•¥
        intent = intent_analysis['intent']['intent']
        
        if intent == 'advice':
            return await self.provide_advice(message, intent_analysis)
        elif intent == 'emotion':
            return await self.provide_empathy(message, intent_analysis)
        elif intent == 'function':
            return await self.execute_function(message, intent_analysis)
        else:
            return await self.normal_chat(message, intent_analysis)
```

### ä½¿ç”¨Promptæ„å»º

```python
# æ„å»ºç”¨æˆ·ä¸Šä¸‹æ–‡
user_context = {
    "analysis": {
        "emotion": {"primary": "ç„¦è™‘"},
        "intent": {
            "intent": "advice",
            "confidence": 0.85,
            "source": "model"
        }
    }
}

# ç”Ÿæˆé’ˆå¯¹æ€§çš„Prompt
prompt = intent_service.build_prompt(user_context)

# å°†promptä¼ é€’ç»™å¤§æ¨¡å‹
response = llm.generate(prompt, user_message)
```

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æé«˜æ„å›¾è¯†åˆ«å‡†ç¡®ç‡ï¼Ÿ

A: æ„å›¾è¯†åˆ«å‡†ç¡®ç‡å–å†³äºï¼š
1. **å…³é”®è¯è§„åˆ™** - å¯ä»¥åœ¨ `rule_engine.py` ä¸­æ·»åŠ æ›´å¤šå…³é”®è¯
2. **MLæ¨¡å‹** - ä½¿ç”¨è®­ç»ƒå¥½çš„BERTæ¨¡å‹æ›¿æ¢å¯å‘å¼è§„åˆ™
3. **ä¸Šä¸‹æ–‡ä¿¡æ¯** - ç»“åˆå¯¹è¯å†å²å’Œç”¨æˆ·ç”»åƒ

### Q2: å¦‚ä½•å¤„ç†å±æœºæƒ…å†µï¼Ÿ

A: å½“æ£€æµ‹åˆ°å±æœºæ„å›¾æ—¶ï¼š
1. `action_required` ä¼šè¿”å› `True`
2. é£é™©ç­‰çº§ä¼šæ ‡è®°ä¸º `high`
3. å»ºè®®æä¾›ï¼š
   - ä¸“ä¸šæ±‚åŠ©çƒ­çº¿ï¼ˆå¦‚å¿ƒç†å±æœºçƒ­çº¿ï¼‰
   - è¡¨è¾¾å…³å¿ƒå’Œæ”¯æŒ
   - å»ºè®®å¯»æ±‚ä¸“ä¸šå¸®åŠ©

ç¤ºä¾‹ä»£ç ï¼š
```python
if result['action_required']:
    crisis_response = {
        "message": "æˆ‘éå¸¸å…³å¿ƒä½ çš„æ„Ÿå—ã€‚å¦‚æœä½ æ­£åœ¨ç»å†å›°éš¾ï¼Œå»ºè®®ä½ è”ç³»ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢å¸ˆã€‚",
        "hotline": "å…¨å›½å¿ƒç†å±æœºå¹²é¢„çƒ­çº¿: 400-161-9995",
        "resources": [
            "24å°æ—¶å¿ƒç†æ´åŠ©çƒ­çº¿",
            "å½“åœ°ç²¾ç¥å«ç”Ÿä¸­å¿ƒ",
            "ç¤¾åŒºå¿ƒç†å’¨è¯¢æœåŠ¡"
        ]
    }
```

### Q3: å¦‚ä½•æ‰©å±•æ–°çš„æ„å›¾ç±»å‹ï¼Ÿ

A: æ­¥éª¤å¦‚ä¸‹ï¼š
1. åœ¨ `intent_models.py` ä¸­æ·»åŠ æ–°çš„ `IntentType`
2. åœ¨ `rule_engine.py` ä¸­æ·»åŠ å¯¹åº”çš„å…³é”®è¯è§„åˆ™
3. åœ¨ `intent_service.py` çš„ `_generate_suggestion` ä¸­æ·»åŠ å“åº”ç­–ç•¥
4. å¦‚æœä½¿ç”¨MLæ¨¡å‹ï¼Œéœ€è¦é‡æ–°è®­ç»ƒæ¨¡å‹

### Q4: æ„å›¾è¯†åˆ«å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ„å›¾è¯†åˆ«æ¨¡å—è®¾è®¡ä¸ºé«˜åº¦å®¹é”™ï¼š
- å¦‚æœæ²¡æœ‰æ˜ç¡®åŒ¹é…ï¼Œé»˜è®¤è¿”å› `conversation` æ„å›¾
- æ‰€æœ‰å¼‚å¸¸éƒ½ä¼šè¢«æ•è·å¹¶è®°å½•æ—¥å¿—
- ä¸ä¼šå½±å“æ­£å¸¸çš„èŠå¤©åŠŸèƒ½

### Q5: å¦‚ä½•ç¦ç”¨æ„å›¾è¯†åˆ«ï¼Ÿ

A: ä¸¤ç§æ–¹å¼ï¼š
1. **åœ¨ChatServiceä¸­**:
   ```python
   chat_service = ChatService(use_intent=False)
   ```

2. **åœ¨é…ç½®æ–‡ä»¶ä¸­** (å¦‚æœæ·»åŠ äº†é…ç½®):
   ```python
   INTENT_ENABLED = False
   ```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨è§„åˆ™å¼•æ“ä¼˜å…ˆ** - å¯¹äºå¸¸è§æ¨¡å¼ï¼Œè§„åˆ™å¼•æ“æ¯”æ¨¡å‹æ›´å¿«
2. **æ‰¹é‡å¤„ç†** - ä½¿ç”¨ `/intent/batch` æ¥å£æ‰¹é‡å¤„ç†å¤šæ¡æ¶ˆæ¯
3. **ç¼“å­˜ç»“æœ** - å¯¹ç›¸åŒæˆ–ç›¸ä¼¼çš„è¾“å…¥å¯ä»¥ç¼“å­˜ç»“æœ
4. **å¼‚æ­¥å¤„ç†** - åœ¨FastAPIä¸­ä½¿ç”¨ `async/await`

## æ›´å¤šèµ„æº

- ğŸ“– [å®Œæ•´æ–‡æ¡£](./æ„å›¾è¯†åˆ«æ¨¡å—è¯´æ˜.md)
- ğŸ”§ [å¢å¼ºç‰ˆè¾“å…¥å¤„ç†å™¨ä½¿ç”¨æŒ‡å—](./å¢å¼ºç‰ˆè¾“å…¥å¤„ç†å™¨ä½¿ç”¨æŒ‡å—.md) â­ **æ–°å¢**
- ğŸ’» [ä»£ç ç¤ºä¾‹](../examples/intent_recognition_demo.py)
- ğŸ§ª [æµ‹è¯•å¥—ä»¶](../test_intent_module.py)
- ğŸŒ [APIæ–‡æ¡£](http://localhost:8000/docs#/intent)

## è”ç³»å’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿ï¼š
- æäº¤ GitHub Issue
- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
- è¿è¡Œç¤ºä¾‹ä»£ç å­¦ä¹ 

---

**ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-17

