graph TB
    subgraph "用户反馈核心模块"
        subgraph "前端反馈界面 (React)"
            A[用户使用聊天机器人] --> B[遇到问题/不满意]
            B --> C[点击反馈按钮]
            C --> D[反馈提交表单]
            D --> D1[选择反馈类型]
            D --> D2[评分 1-5分]
            D --> D3[填写详细评论]
            D --> D4[提交反馈]
        end
        
        subgraph "后端API服务 (FastAPI)"
            D4 --> E[POST /feedback]
            E --> F[验证反馈数据]
            F --> G[保存到数据库]
            G --> H[返回反馈ID]
            
            I[GET /feedback/statistics] --> J[统计反馈数据]
            K[GET /feedback/list] --> L[查询反馈列表]
        end
        
        subgraph "数据存储层 (MySQL)"
            G --> M[(user_feedback表)]
            M --> M1[feedback_id]
            M --> M2[session_id]
            M --> M3[user_id]
            M --> M4[feedback_type]
            M --> M5[rating]
            M --> M6[comment]
            M --> M7[created_at]
        end
        
        subgraph "分析工具 (Python)"
            M --> N[反馈分析器]
            N --> N1[按类型统计]
            N --> N2[按评分统计]
            N --> N3[关键词提取]
            N --> N4[情感分析]
            
            N --> O[Prompt优化器]
            O --> O1[分析低分反馈]
            O --> O2[识别问题模式]
            O --> O3[生成优化建议]
            O --> O4[创建新Prompt版本]
        end
        
        subgraph "优化循环"
            O4 --> P[A/B测试新Prompt]
            P --> Q[评估改进效果]
            Q --> R{效果是否显著?}
            R -->|是| S[部署新版本]
            R -->|否| T[继续优化]
            S --> U[监控用户反馈]
            T --> O
            U --> A
        end
    end
    
    style A fill:#e3f2fd
    style D fill:#f3e5f5
    style E fill:#e8f5e9
    style M fill:#fff3e0
    style N fill:#fce4ec
    style O fill:#f1f8e9
    style S fill:#e0f2f1
