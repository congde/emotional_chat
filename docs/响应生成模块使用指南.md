# å“åº”ç”Ÿæˆæ¨¡å—ä½¿ç”¨æŒ‡å—

> **ä»"å¬æ‡‚"åˆ°"è¯´å¥½"â€”â€”è®©AIçœŸæ­£æ‡‚å¾—"å…±æƒ…å¼å›åº”"**

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»"å¿ƒè¯­"æƒ…æ„Ÿé™ªä¼´æœºå™¨äººçš„å“åº”ç”Ÿæˆæ¨¡å—çš„æ¶æ„è®¾è®¡ã€ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚

---

## ç›®å½•

1. [æ¨¡å—æ¦‚è¿°](#æ¨¡å—æ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [è¯¦ç»†ä½¿ç”¨è¯´æ˜](#è¯¦ç»†ä½¿ç”¨è¯´æ˜)
5. [é…ç½®ä¸å®šåˆ¶](#é…ç½®ä¸å®šåˆ¶)
6. [æµ‹è¯•ä¸éªŒè¯](#æµ‹è¯•ä¸éªŒè¯)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¨¡å—æ¦‚è¿°

### è®¾è®¡ç†å¿µ

å“åº”ç”Ÿæˆæ¨¡å—æ˜¯"å¿ƒè¯­"æœºå™¨äººçš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ï¼Œå®ç°äº†ä»"æ„ŸçŸ¥æƒ…ç»ª"åˆ°"ç”Ÿæˆå›å¤"çš„å®Œæ•´é“¾è·¯ã€‚å…¶è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

- **æƒ…æ„Ÿé©±åŠ¨**ï¼šæ ¹æ®ç”¨æˆ·æƒ…ç»ªåŠ¨æ€è°ƒæ•´å›åº”ç­–ç•¥
- **å¤šå±‚é˜²æŠ¤**ï¼šè§„åˆ™å¼•æ“ + ç¼“å­˜ + LLM + ä¸€è‡´æ€§æ ¡éªŒ
- **äººæ€§æ¸©æš–**ï¼šæ¯ä¸€æ¬¡å›å¤éƒ½è´´åˆç”¨æˆ·æƒ…ç»ªï¼Œé¿å…æœºæ¢°æ„Ÿ
- **å®‰å…¨å¯æ§**ï¼šå±æœºå¹²é¢„ä¼˜å…ˆï¼Œå†…å®¹æ ¡éªŒä¸¥æ ¼

### æŠ€æœ¯ç‰¹ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|-----|------|
| **åŠ¨æ€Promptç”Ÿæˆ** | æ ¹æ®æƒ…ç»ªã€å¼ºåº¦ã€å†å²è‡ªåŠ¨æ„å»ºPrompt |
| **æ··åˆç”Ÿæˆæ¶æ„** | è§„åˆ™/ç¼“å­˜/LLMä¸‰å±‚ç”Ÿæˆç­–ç•¥ |
| **æƒ…æ„Ÿä¸€è‡´æ€§æ ¡éªŒ** | è‡ªåŠ¨æ£€æµ‹å›å¤æƒ…ç»ªæ˜¯å¦åŒ¹é…ç”¨æˆ· |
| **å±æœºå¹²é¢„æœºåˆ¶** | é«˜é£é™©åœºæ™¯è‡ªåŠ¨è§¦å‘é¢„è®¾å›å¤ |
| **ä¸ªæ€§åŒ–å®šåˆ¶** | æ”¯æŒç”¨æˆ·ç”»åƒå’Œåå¥½è®¾ç½® |

---

## æ ¸å¿ƒæ¶æ„

### æ¨¡å—ç»„æˆ

```
å“åº”ç”Ÿæˆæ¨¡å—
â”œâ”€â”€ config/
â”‚   â””â”€â”€ emotion_strategy.yaml          # æƒ…æ„Ÿç­–ç•¥é…ç½®
â”œâ”€â”€ modules/intent/core/
â”‚   â”œâ”€â”€ response_generator.py          # æ ¸å¿ƒç”Ÿæˆå™¨
â”‚   â””â”€â”€ dynamic_prompt_builder.py      # åŠ¨æ€Promptæ„å»º
â””â”€â”€ utils/
    â””â”€â”€ sentiment_classifier.py        # æƒ…æ„Ÿä¸€è‡´æ€§æ ¡éªŒ
```

### å¤„ç†æµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
æƒ…æ„Ÿè¯†åˆ« (enhanced_input_processor.py)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      å“åº”ç”Ÿæˆå™¨ (response_generator)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. å±æœºæ£€æµ‹ â†’ é¢„è®¾å›å¤ï¼ˆå¦‚æœ‰ï¼‰       â”‚
â”‚ 2. ç¼“å­˜åŒ¹é… â†’ å›ºå®šå›å¤ï¼ˆé«˜é¢‘ï¼‰       â”‚
â”‚ 3. LLMç”Ÿæˆ â†’ åŠ¨æ€å›å¤ï¼ˆä¸»è·¯å¾„ï¼‰      â”‚
â”‚    â”œâ”€ æ„å»ºåŠ¨æ€Prompt                â”‚
â”‚    â”œâ”€ è°ƒç”¨å¤§æ¨¡å‹                    â”‚
â”‚    â”œâ”€ åå¤„ç†                        â”‚
â”‚    â””â”€ ä¸€è‡´æ€§æ ¡éªŒ                    â”‚
â”‚ 4. é™çº§ç­–ç•¥ â†’ å…œåº•å›å¤ï¼ˆå¼‚å¸¸æ—¶ï¼‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
AIå›å¤è¾“å‡º
```

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# ç¡®ä¿å·²å®‰è£…åŸºç¡€ä¾èµ–
pip install pyyaml

# å¯é€‰ï¼šå¦‚æœéœ€è¦ä½¿ç”¨é«˜çº§æƒ…æ„Ÿåˆ†æ
pip install transformers torch
```

### åŸºç¡€ä½¿ç”¨

```python
from backend.modules.intent.core.response_generator import ResponseGenerator
from langchain_openai import ChatOpenAI

# 1. åˆ›å»ºLLMå®¢æˆ·ç«¯
llm_client = ChatOpenAI(
    api_key="your_api_key",
    base_url="https://api.openai.com/v1",
    model_name="gpt-4",
    temperature=0.7
)

# 2. åˆ›å»ºå“åº”ç”Ÿæˆå™¨
generator = ResponseGenerator(llm_client)

# 3. ç”Ÿæˆå›å¤
result = generator.generate_response(
    user_input="æˆ‘ä»Šå¤©è¢«é¢†å¯¼æ‰¹è¯„äº†ï¼Œè§‰å¾—è‡ªå·±ä¸€æ— æ˜¯å¤„",
    user_emotion="sad",              # æƒ…ç»ªç±»å‹
    user_id="user_001",              # ç”¨æˆ·ID
    emotion_intensity=7.5            # æƒ…ç»ªå¼ºåº¦(0-10)
)

# 4. è·å–ç»“æœ
print(f"AIå›å¤: {result['response']}")
print(f"ç”Ÿæˆæ–¹æ³•: {result['generation_method']}")
print(f"æ˜¯å¦æœ‰æ•ˆ: {result['is_valid']}")
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_response_generation.py

# é¢„æœŸè¾“å‡ºï¼š
# âœ“ é€šè¿‡ - ç­–ç•¥é…ç½®åŠ è½½
# âœ“ é€šè¿‡ - åŠ¨æ€Promptæ„å»º
# âœ“ é€šè¿‡ - æƒ…æ„Ÿä¸€è‡´æ€§æ ¡éªŒ
# âœ“ é€šè¿‡ - å®Œæ•´å“åº”ç”Ÿæˆ
# âœ“ é€šè¿‡ - å±æœºå¹²é¢„è§¦å‘
# âœ“ é€šè¿‡ - ç¼“å­˜å›å¤åŒ¹é…
```

---

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. å“åº”ç”Ÿæˆå™¨ (ResponseGenerator)

#### åˆå§‹åŒ–å‚æ•°

```python
generator = ResponseGenerator(
    llm_client,                          # LLMå®¢æˆ·ç«¯ï¼ˆå¿…éœ€ï¼‰
    strategy_file="config/emotion_strategy.yaml",  # ç­–ç•¥æ–‡ä»¶è·¯å¾„
    enable_consistency_check=True,       # æ˜¯å¦å¯ç”¨ä¸€è‡´æ€§æ£€æŸ¥
    enable_cache=True                    # æ˜¯å¦å¯ç”¨ç¼“å­˜
)
```

#### ç”Ÿæˆå›å¤

```python
result = generator.generate_response(
    user_input="ç”¨æˆ·çš„è¾“å…¥æ–‡æœ¬",           # å¿…éœ€
    user_emotion="sad",                  # å¿…éœ€ï¼šæƒ…ç»ªç±»å‹
    user_id="user_001",                  # å¿…éœ€ï¼šç”¨æˆ·ID
    emotion_intensity=7.5,               # å¯é€‰ï¼šæƒ…ç»ªå¼ºåº¦(0-10)ï¼Œé»˜è®¤5.0
    conversation_history=[               # å¯é€‰ï¼šå¯¹è¯å†å²
        {"role": "user", "content": "ä¹‹å‰çš„å¯¹è¯..."},
        {"role": "assistant", "content": "AIçš„å›å¤..."}
    ],
    retrieved_memories=[                 # å¯é€‰ï¼šæ£€ç´¢åˆ°çš„è®°å¿†
        {
            "content": "ç”¨æˆ·ä¸Šå‘¨æåˆ°è¿‡å·¥ä½œå‹åŠ›å¤§",
            "importance": 0.8,
            "timestamp": "2025-10-11T10:00:00"
        }
    ],
    user_profile={                       # å¯é€‰ï¼šç”¨æˆ·ç”»åƒ
        "preferred_tone": "æ¸©æŸ”",
        "avoid_topics": ["å®¶åº­"],
        "communication_style": "å€¾å¬å‹"
    },
    metadata={                           # å¯é€‰ï¼šé¢å¤–å…ƒæ•°æ®
        "requires_crisis_intervention": False,
        "risk_keywords": []
    }
)
```

#### è¿”å›ç»“æœ

```python
{
    "response": "æˆ‘èƒ½æ„Ÿå—åˆ°ä½ ç°åœ¨çš„ä½è½...",  # ç”Ÿæˆçš„å›å¤æ–‡æœ¬
    "generation_method": "llm_generated",      # ç”Ÿæˆæ–¹æ³•
    "is_valid": True,                         # æ˜¯å¦é€šè¿‡æ ¡éªŒ
    "warnings": [],                           # è­¦å‘Šä¿¡æ¯åˆ—è¡¨
    "metadata": {                             # å…ƒæ•°æ®
        "user_emotion": "sad",
        "emotion_intensity": 7.5,
        "timestamp": "2025-10-18T..."
    }
}
```

**generation_method å¯èƒ½çš„å€¼ï¼š**
- `rule_based_crisis`: è§„åˆ™å¼•æ“ï¼ˆå±æœºå¹²é¢„ï¼‰
- `cached`: ç¼“å­˜åŒ¹é…
- `llm_generated`: LLMç”Ÿæˆ
- `fallback`: é™çº§å…œåº•
- `fallback_error`: å¼‚å¸¸å…œåº•

### 2. åŠ¨æ€Promptæ„å»ºå™¨ (DynamicPromptBuilder)

#### ç›´æ¥ä½¿ç”¨

```python
from backend.modules.intent.core.dynamic_prompt_builder import DynamicPromptBuilder
import yaml

# åŠ è½½ç­–ç•¥
with open("config/emotion_strategy.yaml", 'r') as f:
    strategy = yaml.safe_load(f)

# åˆ›å»ºæ„å»ºå™¨
builder = DynamicPromptBuilder(strategy)

# æ„å»ºå®Œæ•´Prompt
prompt = builder.build_prompt(
    user_input="æˆ‘ä»Šå¤©å¾ˆç„¦è™‘",
    emotion="anxious",
    emotion_intensity=6.5,
    conversation_history=[...],
    retrieved_memories=[...],
    user_profile={...}
)

# æ„å»ºç®€åŒ–Promptï¼ˆå¿«é€Ÿå“åº”ï¼‰
simple_prompt = builder.build_simple_prompt(
    user_input="æˆ‘ä»Šå¤©å¾ˆç„¦è™‘",
    emotion="anxious"
)
```

#### Promptæ¨¡æ¿è‡ªå®šä¹‰

å¯ä»¥é€šè¿‡ä¿®æ”¹ `DynamicPromptBuilder` ç±»ä¸­çš„æ¨¡æ¿å¸¸é‡æ¥å®šåˆ¶Promptï¼š

```python
# ä¿®æ”¹åŸºç¡€ç³»ç»ŸPrompt
builder.BASE_SYSTEM_TEMPLATE = """
# ä½ çš„è‡ªå®šä¹‰è§’è‰²è®¾å®š
...
"""

# ä¿®æ”¹æƒ…æ„Ÿé©±åŠ¨æ¨¡æ¿
builder.EMOTION_DRIVEN_TEMPLATE = """
...
"""
```

### 3. æƒ…æ„Ÿä¸€è‡´æ€§æ ¡éªŒå™¨ (SentimentClassifier)

#### åŸºç¡€æ ¡éªŒ

```python
from backend.utils.sentiment_classifier import SentimentClassifier

classifier = SentimentClassifier()

# æ£€æŸ¥æƒ…æ„Ÿä¸€è‡´æ€§
is_consistent, reason = classifier.check_emotion_consistency(
    ai_response="æˆ‘èƒ½æ„Ÿå—åˆ°ä½ çš„éš¾è¿‡...",
    user_emotion="sad"
)

print(f"æ˜¯å¦ä¸€è‡´: {is_consistent}")
print(f"åŸå› : {reason}")
```

#### ç»¼åˆæ£€æŸ¥

```python
result = classifier.comprehensive_check(
    ai_response="å“ˆå“ˆï¼Œè¿™æœ‰ä»€ä¹ˆå¥½éš¾è¿‡çš„ï¼",
    user_emotion="sad",
    expected_tone="æ¸©æŸ”"
)

print(f"æ˜¯å¦æœ‰æ•ˆ: {result['is_valid']}")
print(f"æƒ…ç»ªä¸€è‡´: {result['emotion_consistent']}")
print(f"åŒ…å«ç¦ç”¨è¯: {result['has_forbidden']}")
print(f"è¯­æ°”ç¬¦åˆ: {result['tone_valid']}")
print(f"è­¦å‘Šä¿¡æ¯: {result['warnings']}")
```

#### ä¾¿æ·å‡½æ•°

```python
from backend.utils.sentiment_classifier import (
    check_emotion_consistency,
    validate_response
)

# å¿«é€Ÿæ£€æŸ¥
is_ok = check_emotion_consistency(ai_response, user_emotion)

# å®Œæ•´éªŒè¯
is_valid, warnings = validate_response(
    ai_response, 
    user_emotion, 
    expected_tone="æ¸©æŸ”"
)
```

---

## é…ç½®ä¸å®šåˆ¶

### æƒ…æ„Ÿç­–ç•¥é…ç½® (emotion_strategy.yaml)

#### æ·»åŠ æ–°æƒ…ç»ªç±»å‹

```yaml
# åœ¨ emotion_strategy.yaml ä¸­æ·»åŠ 
my_new_emotion:
  goal: "å›åº”ç›®æ ‡"
  tone: "è¯­æ°”è¦æ±‚"
  empathy_level: "high"  # high/medium/low
  keywords:
    - "å…³é”®è¯1"
    - "å…³é”®è¯2"
  response_patterns:
    - "å›åº”æ¨¡å¼1"
    - "å›åº”æ¨¡å¼2"
  avoid_words:
    - "é¿å…è¯1"
  max_length: 3
  use_emoji: true
  emoji_suggestions: ["ğŸ˜Š", "ğŸ’–"]
  fallback: "å…œåº•å›å¤"
  examples:
    - input: "ç”¨æˆ·è¾“å…¥ç¤ºä¾‹"
      output: "AIå›å¤ç¤ºä¾‹"
```

#### ä¿®æ”¹å…¨å±€é…ç½®

```yaml
global_settings:
  # æƒ…ç»ªå¼ºåº¦é˜ˆå€¼
  intensity_thresholds:
    low: 3
    medium: 6
    high: 10
  
  # ç¼“å­˜å›å¤
  cached_responses:
    greeting:
      - "ä½ å¥½ï¼æˆ‘æ˜¯å¿ƒè¯­ğŸ˜Š"
      - "å—¨ï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼"
    
    goodbye:
      - "å†è§ï¼ä¿é‡å“¦ğŸ‘‹"
    
    thanks:
      - "ä¸å®¢æ°”ï¼å¾ˆé«˜å…´å¸®åˆ°ä½ ğŸ˜Š"
  
  # å›å¤é•¿åº¦é™åˆ¶
  max_sentence_count: 3
  max_word_count: 100
  
  # è¡¨æƒ…ç¬¦å·ä½¿ç”¨
  emoji_usage:
    enabled: true
    max_per_response: 2
    avoid_in_emotions: ["angry", "high_risk_depression"]
```

### è‡ªå®šä¹‰LLMå®¢æˆ·ç«¯

å¦‚æœä½¿ç”¨éOpenAIçš„æ¨¡å‹ï¼Œéœ€è¦åŒ…è£…å®¢æˆ·ç«¯æ¥å£ï¼š

```python
class CustomLLMClient:
    def __init__(self, your_model):
        self.model = your_model
    
    def predict(self, prompt: str) -> str:
        """å¿…é¡»å®ç°predictæ–¹æ³•"""
        response = self.model.generate(prompt)
        return response.text
    
    # æˆ–å®ç° generate / invoke æ–¹æ³•
    def generate(self, prompt: str) -> str:
        return self.predict(prompt)

# ä½¿ç”¨è‡ªå®šä¹‰å®¢æˆ·ç«¯
custom_client = CustomLLMClient(your_model)
generator = ResponseGenerator(custom_client)
```

### æ·»åŠ ç”¨æˆ·ç”»åƒæ”¯æŒ

```python
# å®šä¹‰ç”¨æˆ·ç”»åƒç»“æ„
user_profile = {
    "preferred_tone": "æ¸©æŸ”",          # åå¥½è¯­æ°”
    "avoid_topics": ["æ”¿æ²»", "å®—æ•™"],   # é¿å…è¯é¢˜
    "communication_style": "å€¾å¬å‹",    # æ²Ÿé€šé£æ ¼
    "emoji_preference": "moderate",     # è¡¨æƒ…ç¬¦å·åå¥½
    "response_length": "short"          # å›å¤é•¿åº¦åå¥½
}

# ä¼ å…¥ç”Ÿæˆå™¨
result = generator.generate_response(
    user_input="...",
    user_emotion="sad",
    user_id="user_001",
    user_profile=user_profile  # ä½¿ç”¨ç”¨æˆ·ç”»åƒ
)
```

---

## æµ‹è¯•ä¸éªŒè¯

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
cd /home/workSpace/emotional_chat
python test_response_generation.py
```

### å•ç‹¬æµ‹è¯•æŸä¸ªåŠŸèƒ½

```python
# æµ‹è¯•ç­–ç•¥åŠ è½½
python -c "
import yaml
with open('backend/config/emotion_strategy.yaml', 'r') as f:
    strategy = yaml.safe_load(f)
print(f'åŠ è½½äº† {len(strategy)} ä¸ªæƒ…æ„Ÿç­–ç•¥')
"

# æµ‹è¯•æƒ…æ„Ÿæ ¡éªŒ
python -c "
from backend.utils.sentiment_classifier import check_emotion_consistency
result = check_emotion_consistency('æˆ‘èƒ½æ„Ÿå—åˆ°ä½ çš„éš¾è¿‡', 'sad')
print(f'ä¸€è‡´æ€§æ£€æŸ¥: {result}')
"
```

### é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

```python
# åœ¨ä½ çš„ä¸»å¯¹è¯é€»è¾‘ä¸­
from backend.modules.intent.core.enhanced_input_processor import EnhancedInputProcessor
from backend.modules.intent.core.response_generator import ResponseGenerator
from your_emotion_analyzer import EmotionAnalyzer

# åˆå§‹åŒ–
input_processor = EnhancedInputProcessor()
emotion_analyzer = EmotionAnalyzer()
response_generator = ResponseGenerator(llm_client)

# å¤„ç†å¯¹è¯
def handle_user_message(user_input, user_id):
    # 1. é¢„å¤„ç†
    processed = input_processor.preprocess(user_input, user_id)
    
    if processed["blocked"]:
        return processed["friendly_message"]
    
    cleaned_input = processed["cleaned"]
    
    # 2. æƒ…æ„Ÿåˆ†æ
    emotion_data = emotion_analyzer.analyze(cleaned_input)
    
    # 3. ç”Ÿæˆå›å¤
    result = response_generator.generate_response(
        user_input=cleaned_input,
        user_emotion=emotion_data["emotion"],
        user_id=user_id,
        emotion_intensity=emotion_data["intensity"],
        metadata=processed["metadata"]
    )
    
    return result["response"]
```

---

## æœ€ä½³å®è·µ

### 1. æƒ…æ„Ÿç­–ç•¥è®¾è®¡

**âœ“ æ¨èåšæ³•ï¼š**
- æ¯ç§æƒ…ç»ªè‡³å°‘æä¾›2ä¸ªç¤ºä¾‹
- æ˜ç¡®å®šä¹‰é¿å…ä½¿ç”¨çš„è¯æ±‡
- è®¾ç½®åˆç†çš„å›å¤é•¿åº¦ï¼ˆé€šå¸¸3å¥è¯ä»¥å†…ï¼‰
- æ ¹æ®æƒ…ç»ªå¼ºåº¦è°ƒæ•´å…±æƒ…ç­‰çº§

**âœ— é¿å…ï¼š**
- ä½¿ç”¨è¯´æ•™æ€§è¯­è¨€ï¼ˆ"ä½ åº”è¯¥..."ï¼‰
- è¿‡åº¦ä½¿ç”¨è¡¨æƒ…ç¬¦å·ï¼ˆæ¯æ¬¡æœ€å¤š2ä¸ªï¼‰
- å›å¤è¿‡é•¿ï¼Œå¤±å»ç„¦ç‚¹

### 2. Promptå·¥ç¨‹

**âœ“ æ¨èåšæ³•ï¼š**
- åœ¨Promptä¸­æ˜ç¡®è§’è‰²è®¾å®šå’Œè¡Œä¸ºå‡†åˆ™
- æä¾›å…·ä½“çš„ç¤ºä¾‹ï¼ˆFew-shotï¼‰
- ä½¿ç”¨ç»“æ„åŒ–çš„Promptæ¨¡æ¿
- èåˆå¯¹è¯å†å²å’Œè®°å¿†

**âœ— é¿å…ï¼š**
- Promptè¿‡äºç®€å•ï¼Œç¼ºä¹ä¸Šä¸‹æ–‡
- æ²¡æœ‰æ˜ç¡®ç¦æ­¢è¡Œä¸º
- å¿½ç•¥æƒ…ç»ªå¼ºåº¦ä¿¡æ¯

### 3. ä¸€è‡´æ€§æ ¡éªŒ

**âœ“ æ¨èåšæ³•ï¼š**
- å§‹ç»ˆå¯ç”¨æƒ…æ„Ÿä¸€è‡´æ€§æ£€æŸ¥
- å¯¹é«˜é£é™©åœºæ™¯ï¼ˆå¦‚å±æœºï¼‰ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
- å®šæœŸå®¡æŸ¥å¤±è´¥æ¡ˆä¾‹ï¼Œä¼˜åŒ–ç­–ç•¥

**âœ— é¿å…ï¼š**
- å®Œå…¨ä¾èµ–LLMè¾“å‡ºï¼Œä¸åšæ ¡éªŒ
- å¿½ç•¥è­¦å‘Šä¿¡æ¯
- è¿‡äºå®½æ¾çš„æ ¡éªŒè§„åˆ™

### 4. æ€§èƒ½ä¼˜åŒ–

**âœ“ æ¨èåšæ³•ï¼š**
- å¯ç”¨ç¼“å­˜åŒ¹é…ï¼Œå‡å°‘LLMè°ƒç”¨
- å¯¹é«˜é¢‘åœºæ™¯ä½¿ç”¨é¢„è®¾å›å¤
- ç›‘æ§ç”Ÿæˆç»Ÿè®¡ï¼Œä¼˜åŒ–ç­–ç•¥

**âœ— é¿å…ï¼š**
- æ¯æ¬¡éƒ½è°ƒç”¨LLMï¼Œå³ä½¿æ˜¯ç®€å•é—®å€™
- ä¸è®°å½•ç»Ÿè®¡ä¿¡æ¯
- å¿½è§†å“åº”æ—¶é—´

### 5. å®‰å…¨ä¸ä¼¦ç†

**âœ“ æ¨èåšæ³•ï¼š**
- å±æœºå¹²é¢„åœºæ™¯å¿…é¡»ä½¿ç”¨è§„åˆ™å¼•æ“
- æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·AIçš„å±€é™æ€§
- æä¾›ä¸“ä¸šæ±‚åŠ©æ¸ é“
- é¿å…ç»™å‡ºåŒ»ç–—/æ³•å¾‹å»ºè®®

**âœ— é¿å…ï¼š**
- ä¾èµ–LLMå¤„ç†å±æœºæƒ…å†µ
- è¶Šç•Œæä¾›ä¸“ä¸šè¯Šæ–­
- å»ºç«‹è¿‡åº¦ä¾èµ–å…³ç³»

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è°ƒæ•´å›å¤çš„è¯­æ°”ï¼Ÿ

ä¿®æ”¹ `emotion_strategy.yaml` ä¸­å¯¹åº”æƒ…ç»ªçš„ `tone` å­—æ®µï¼š

```yaml
sad:
  tone: "æ¸©æŸ”ã€ç¼“æ…¢ã€åŒ…å®¹"  # ä¿®æ”¹ä¸ºä½ æƒ³è¦çš„è¯­æ°”æè¿°
```

### Q2: å¦‚ä½•æ·»åŠ æ–°çš„è¡¨æƒ…ç¬¦å·ï¼Ÿ

åœ¨ç­–ç•¥é…ç½®ä¸­çš„ `emoji_suggestions` æ·»åŠ ï¼š

```yaml
sad:
  emoji_suggestions: ["ğŸ’™", "ğŸ¤—", "ğŸŒ™", "âœ¨", "ä½ çš„æ–°è¡¨æƒ…"]
```

### Q3: å›å¤å¤ªé•¿/å¤ªçŸ­æ€ä¹ˆåŠï¼Ÿ

è°ƒæ•´ `max_length` å‚æ•°ï¼ˆå•ä½ï¼šå¥å­æ•°ï¼‰ï¼š

```yaml
sad:
  max_length: 2  # æ”¹ä¸º2å¥è¯
```

### Q4: å¦‚ä½•ç¦ç”¨æƒ…æ„Ÿä¸€è‡´æ€§æ£€æŸ¥ï¼Ÿ

```python
generator = ResponseGenerator(
    llm_client,
    enable_consistency_check=False  # ç¦ç”¨æ£€æŸ¥
)
```

**æ³¨æ„ï¼š** ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒç¦ç”¨ã€‚

### Q5: å¦‚ä½•è‡ªå®šä¹‰å±æœºå¹²é¢„å›å¤ï¼Ÿ

ä¿®æ”¹ `emotion_strategy.yaml` ä¸­çš„ `high_risk_depression` é…ç½®ï¼š

```yaml
high_risk_depression:
  fallback: "ä½ çš„è‡ªå®šä¹‰å±æœºå›å¤..."
  crisis_hotlines:
    - name: "ä½ çš„çƒ­çº¿åç§°"
      number: "çƒ­çº¿ç”µè¯"
```

### Q6: å¦‚ä½•é›†æˆç”¨æˆ·è®°å¿†ï¼Ÿ

é€šè¿‡ `retrieved_memories` å‚æ•°ä¼ å…¥ï¼š

```python
from backend.memory_manager import MemoryManager

memory_manager = MemoryManager()

# æ£€ç´¢ç›¸å…³è®°å¿†
memories = memory_manager.retrieve_memories(
    user_id=user_id,
    query=user_input,
    n_results=3
)

# ä¼ å…¥ç”Ÿæˆå™¨
result = generator.generate_response(
    user_input=user_input,
    user_emotion=emotion,
    user_id=user_id,
    retrieved_memories=memories  # ä½¿ç”¨è®°å¿†
)
```

### Q7: å¦‚ä½•å¤„ç†å¤šè¯­è¨€ï¼Ÿ

ç›®å‰ä¸»è¦æ”¯æŒä¸­æ–‡ã€‚å¦‚éœ€æ”¯æŒå…¶ä»–è¯­è¨€ï¼š

1. åœ¨ç­–ç•¥é…ç½®ä¸­æ·»åŠ å¯¹åº”è¯­è¨€çš„å…³é”®è¯
2. ä¿®æ”¹æƒ…æ„Ÿæ ¡éªŒå™¨çš„å…³é”®è¯æ˜ å°„
3. è°ƒæ•´Promptæ¨¡æ¿ä¸­çš„è¯­è¨€

### Q8: ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯åœ¨å“ªé‡ŒæŸ¥çœ‹ï¼Ÿ

```python
stats = generator.get_statistics()

print(f"æ€»è®¡: {stats['total_generations']}")
print(f"LLMç”Ÿæˆç‡: {stats['llm_rate']:.2%}")
print(f"ç¼“å­˜å‘½ä¸­ç‡: {stats['cached_rate']:.2%}")
print(f"å¤±è´¥ç‡: {stats['failure_rate']:.2%}")
```

---

## ç‰ˆæœ¬æ›´æ–°

### v1.0.0 (2025-10-18)

- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ å®ç°æƒ…æ„Ÿé©±åŠ¨çš„åŠ¨æ€Promptç”Ÿæˆ
- ğŸ›¡ï¸ é›†æˆæƒ…æ„Ÿä¸€è‡´æ€§æ ¡éªŒæœºåˆ¶
- ğŸš¨ å®Œå–„å±æœºå¹²é¢„å¤„ç†æµç¨‹
- ğŸ“Š æ·»åŠ ç”Ÿæˆç»Ÿè®¡åŠŸèƒ½
- ğŸ“ å®Œæ•´çš„æ–‡æ¡£å’Œæµ‹è¯•å¥—ä»¶

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š

- **ä½œè€…**: è¢ä»å¾·
- **é¡¹ç›®**: emotional_chat
- **æ–‡æ¡£**: `/docs/å“åº”ç”Ÿæˆæ¨¡å—ä½¿ç”¨æŒ‡å—.md`

---

## è®¸å¯è¯

æœ¬æ¨¡å—éµå¾ªé¡¹ç›®æ•´ä½“è®¸å¯è¯ã€‚è¯¦è§æ ¹ç›®å½• `LICENSE` æ–‡ä»¶ã€‚

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼è®©æˆ‘ä»¬ä¸€èµ·æ‰“é€ æœ‰æ¸©åº¦çš„AIé™ªä¼´è€…ã€‚** ğŸ’–

