# ä¸ªæ€§åŒ–é…ç½®åŠŸèƒ½ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

### æ­¥éª¤1ï¼šæ•°æ®åº“è¿ç§»

```bash
# æ–¹å¼1: ä½¿ç”¨SQLè„šæœ¬
cd backend/migrations
mysql -u root -p emotional_chat < add_personalization_table.sql

# æ–¹å¼2: ä½¿ç”¨Pythonåˆ›å»ºï¼ˆå¦‚æœæœ‰create_tableså‡½æ•°ï¼‰
cd backend
python -c "from database import create_tables; create_tables()"
```

### æ­¥éª¤2ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
python main.py

# æœåŠ¡å¯åŠ¨åï¼Œè®¿é—®APIæ–‡æ¡£
# http://localhost:8000/docs
```

### æ­¥éª¤3ï¼šå¯åŠ¨å‰ç«¯æœåŠ¡

```bash
cd frontend
npm install  # å¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œ
npm start

# å‰ç«¯å¯åŠ¨åï¼Œè®¿é—®
# http://localhost:3000
```

### æ­¥éª¤4ï¼šæµ‹è¯•ä¸ªæ€§åŒ–é…ç½®

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000`
2. ç‚¹å‡»å·¦ä¾§è¾¹æ çš„"ä¸ªæ€§åŒ–é…ç½®"æŒ‰é’®
3. é€‰æ‹©ä¸€ä¸ªè§’è‰²æ¨¡æ¿ï¼ˆå¦‚"æ™ºæ…§å¯¼å¸ˆ"ï¼‰
4. è°ƒæ•´é£æ ¼å‚æ•°
5. ç‚¹å‡»"ä¿å­˜é…ç½®"
6. å‘é€æ¶ˆæ¯æµ‹è¯•AIå›å¤

## ğŸ§ª APIæµ‹è¯•

### æµ‹è¯•1ï¼šè·å–è§’è‰²æ¨¡æ¿

```bash
curl http://localhost:8000/api/personalization/templates
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
[
  {
    "id": "warm_listener",
    "name": "æ¸©æš–å€¾å¬è€…",
    "icon": "â¤ï¸",
    ...
  }
]
```

### æµ‹è¯•2ï¼šè·å–ç”¨æˆ·é…ç½®

```bash
curl http://localhost:8000/api/personalization/config/test_user
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "user_id": "test_user",
  "config": {
    "role": "æ¸©æš–å€¾å¬è€…",
    "role_name": "å¿ƒè¯­",
    ...
  },
  "is_default": true
}
```

### æµ‹è¯•3ï¼šæ›´æ–°é…ç½®

```bash
curl -X POST http://localhost:8000/api/personalization/config/test_user \
  -H "Content-Type: application/json" \
  -d '{
    "role": "æ™ºæ…§å¯¼å¸ˆ",
    "role_name": "æ™ºè€…",
    "tone": "æ²‰ç¨³",
    "empathy_level": 0.7
  }'
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "user_id": "test_user",
  "config": {
    "role": "æ™ºæ…§å¯¼å¸ˆ",
    "role_name": "æ™ºè€…",
    ...
  },
  "is_default": false
}
```

### æµ‹è¯•4ï¼šåº”ç”¨æ¨¡æ¿

```bash
curl -X POST "http://localhost:8000/api/personalization/config/test_user/apply-template?template_id=wise_mentor"
```

### æµ‹è¯•5ï¼šé¢„è§ˆPrompt

```bash
curl "http://localhost:8000/api/personalization/preview/test_user?context=ä»Šå¤©å¾ˆå¼€å¿ƒ&emotion=happy&intensity=8"
```

**æœŸæœ›è¾“å‡º**ï¼š
```json
{
  "user_id": "test_user",
  "config_summary": {
    "role": "æ™ºæ…§å¯¼å¸ˆ",
    "tone": "æ²‰ç¨³",
    ...
  },
  "prompt": "ä½ æ˜¯'æ™ºè€…'ï¼Œä¸€ä½æ™ºæ…§å¯¼å¸ˆ..."
}
```

## ğŸ¯ åŠŸèƒ½éªŒè¯æ¸…å•

- [ ] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
- [ ] åç«¯APIæ­£å¸¸è¿è¡Œ
- [ ] å‰ç«¯ç•Œé¢æ­£å¸¸æ˜¾ç¤º
- [ ] å¯ä»¥æ‰“å¼€ä¸ªæ€§åŒ–é…ç½®é¢æ¿
- [ ] å¯ä»¥æŸ¥çœ‹5ä¸ªè§’è‰²æ¨¡æ¿
- [ ] å¯ä»¥åº”ç”¨è§’è‰²æ¨¡æ¿
- [ ] å¯ä»¥è°ƒæ•´é£æ ¼æ»‘å—
- [ ] å¯ä»¥ä¿å­˜é…ç½®
- [ ] é…ç½®å¯ä»¥æ­£å¸¸è¯»å–

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šæ•°æ®åº“è¡¨ä¸å­˜åœ¨

**ç—‡çŠ¶**ï¼šAPIè¿”å›æ•°æ®åº“é”™è¯¯

**è§£å†³**ï¼š
```bash
cd backend/migrations
mysql -u root -p emotional_chat < add_personalization_table.sql
```

### é—®é¢˜2ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

**ç—‡çŠ¶**ï¼šå‰ç«¯æ˜¾ç¤º"åŠ è½½é…ç½®å¤±è´¥"

**æ£€æŸ¥**ï¼š
1. åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆè®¿é—® http://localhost:8000/healthï¼‰
2. CORSæ˜¯å¦æ­£ç¡®é…ç½®
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç½‘ç»œè¯·æ±‚

**è§£å†³**ï¼š
```javascript
// æ£€æŸ¥ frontend/src/components/PersonalizationPanel.js ä¸­çš„API_BASE
const API_BASE = 'http://localhost:8000';
```

### é—®é¢˜3ï¼šé…ç½®æ— æ³•ä¿å­˜

**ç—‡çŠ¶**ï¼šç‚¹å‡»ä¿å­˜åæç¤ºå¤±è´¥

**æ£€æŸ¥**ï¼š
1. æ£€æŸ¥åç«¯æ—¥å¿—
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥
3. éªŒè¯æ•°æ®æ ¼å¼

**è°ƒè¯•**ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
cd backend
python main.py  # è§‚å¯Ÿæ§åˆ¶å°è¾“å‡º
```

### é—®é¢˜4ï¼šè§’è‰²æ¨¡æ¿ä¸æ˜¾ç¤º

**ç—‡çŠ¶**ï¼šé…ç½®é¢æ¿ä¸­è§’è‰²å¡ç‰‡ä¸ºç©º

**æ£€æŸ¥**ï¼š
```bash
# æµ‹è¯•API
curl http://localhost:8000/api/personalization/templates

# åº”è¯¥è¿”å›5ä¸ªæ¨¡æ¿
```

**è§£å†³**ï¼š
- ç¡®ä¿ `backend/services/prompt_composer.py` ä¸­çš„ `ROLE_TEMPLATES` å®šä¹‰æ­£ç¡®
- é‡å¯åç«¯æœåŠ¡

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨é…ç½®ç¼“å­˜

é…ç½®å·²è‡ªåŠ¨ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

```python
# backend/services/personalization_service.py
# å¯ä»¥æ·»åŠ Redisç¼“å­˜æ›¿ä»£å†…å­˜ç¼“å­˜
```

### 2. æ•°æ®åº“ç´¢å¼•

ç¡®ä¿user_idå­—æ®µæœ‰ç´¢å¼•ï¼š

```sql
CREATE INDEX idx_user_id ON user_personalizations(user_id);
```

### 3. å‰ç«¯ç¼“å­˜

åœ¨å‰ç«¯localStorageä¸­ç¼“å­˜é…ç½®ï¼š

```javascript
// ä¿å­˜åˆ°localStorage
localStorage.setItem('user_config', JSON.stringify(config));

// ä¸‹æ¬¡è®¿é—®æ—¶ä¼˜å…ˆä»localStorageè¯»å–
```

## ğŸ” å®‰å…¨å»ºè®®

### 1. APIè®¿é—®æ§åˆ¶

æ·»åŠ è®¤è¯ä¸­é—´ä»¶ï¼š

```python
# backend/routers/personalization.py
@router.get("/config/{user_id}", dependencies=[Depends(verify_user)])
async def get_user_config(user_id: str):
    # éªŒè¯ç”¨æˆ·æƒé™
    pass
```

### 2. è¾“å…¥éªŒè¯

ç¡®ä¿æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡éªŒè¯ï¼š

```python
# é™åˆ¶å­—ç¬¦ä¸²é•¿åº¦
role_name: str = Field(..., min_length=1, max_length=100)

# é™åˆ¶æ•°å€¼èŒƒå›´
formality: float = Field(..., ge=0, le=1)
```

### 3. æ•æ„Ÿè¯è¿‡æ»¤

å¯¹ç”¨æˆ·è‡ªå®šä¹‰å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼š

```python
def filter_sensitive_words(text: str) -> str:
    """è¿‡æ»¤æ•æ„Ÿè¯"""
    # å®ç°æ•æ„Ÿè¯è¿‡æ»¤é€»è¾‘
    return text
```

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
# backend/logging_config.py
import logging

logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
```

### ç›‘æ§å…³é”®æŒ‡æ ‡

```python
# ç›‘æ§é…ç½®æ›´æ–°é¢‘ç‡
logger.info(f"ç”¨æˆ· {user_id} æ›´æ–°é…ç½®ï¼Œç‰ˆæœ¬: {config_version}")

# ç›‘æ§APIå“åº”æ—¶é—´
import time
start = time.time()
# ... å¤„ç†è¯·æ±‚
logger.info(f"è¯·æ±‚è€—æ—¶: {time.time() - start:.3f}s")
```

## ğŸ“ ä¸‹ä¸€æ­¥

1. **é›†æˆåˆ°å¯¹è¯æµç¨‹**
   - å‚è€ƒ `backend/services/chat_service_integration_example.py`
   - ä¿®æ”¹ `backend/services/chat_service.py`

2. **å¯ç”¨å­¦ä¹ æ¨¡å¼**
   - æ”¶é›†ç”¨æˆ·åé¦ˆ
   - è‡ªåŠ¨è°ƒæ•´é…ç½®å‚æ•°

3. **æ·»åŠ æ›´å¤šè§’è‰²æ¨¡æ¿**
   - åœ¨ `backend/services/prompt_composer.py` ä¸­æ·»åŠ æ–°æ¨¡æ¿
   - è®¾è®¡ç‹¬ç‰¹çš„è§’è‰²äººæ ¼

4. **å®ç°æƒ…å¢ƒåŒ–è§’è‰²**
   - åŸºäºæ—¶é—´è‡ªåŠ¨åˆ‡æ¢è§’è‰²
   - åŸºäºæƒ…ç»ªçŠ¶æ€è°ƒæ•´è¡¨è¾¾é£æ ¼

5. **å¼€å‘è§’è‰²å·¥åŠ**
   - å…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå®šä¹‰è§’è‰²
   - æ”¯æŒè§’è‰²åˆ†äº«å’Œå¯¼å…¥

## ğŸ“š å‚è€ƒèµ„æ–™

- [å®Œæ•´æ–‡æ¡£](./ä¸ªæ€§åŒ–é…ç½®åŠŸèƒ½æ–‡æ¡£.md)
- [APIæ–‡æ¡£](http://localhost:8000/docs)
- [ç¤ºä¾‹ä»£ç ](../backend/services/chat_service_integration_example.py)
- [æ•°æ®åº“è¿ç§»](../backend/migrations/add_personalization_table.sql)

## ğŸ’¬ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹[å®Œæ•´æ–‡æ¡£](./ä¸ªæ€§åŒ–é…ç½®åŠŸèƒ½æ–‡æ¡£.md)ä¸­çš„å¸¸è§é—®é¢˜
2. æäº¤[GitHub Issue](https://github.com/your-repo/issues)
3. åŠ å…¥ç¤¾åŒºè®¨è®º

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

è®©æ¯ä¸€ä¸ªAIï¼Œéƒ½æˆä¸º"ä½ çš„AI"ã€‚

